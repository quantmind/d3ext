!function(a){var b;b="object"==typeof module&&module.exports?module.exports:window,"function"==typeof define&&define.amd?define(["d3"],function(){return a(d3,b)}):"object"==typeof module&&module.exports&&a(d3,b)}(function(a,b){function c(a){return a}function d(){return 0}function e(a){return"function"==typeof a?a:function(){return a}}function f(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function g(a){return a.rangeExtent?a.rangeExtent():f(a.range())}function h(a){return a[0]}function i(a){return a[1]}function j(){return!0}function k(a,b){return(b[1]-a[1])/(b[0]-a[0])}function l(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function m(a,b){for(var c,d=[],e=(1-b)/2,f=a[0],g=a[1],h=1,i=a.length;++h<i;)c=f,f=g,g=a[h],d.push([e*(g[0]-c[0]),e*(g[1]-c[1])]);return d}function n(a){for(var b=0,c=a.length-1,d=[],e=a[0],f=a[1],g=d[0]=k(e,f);++b<c;)d[b]=(g+(g=k(e=f,f=a[b+1])))/2;return d[b]=g,d}function o(a){for(var b,c,d,e,f=[],g=n(a),h=-1,i=a.length-1;++h<i;)b=k(a[h],a[h+1]),gb(b)<ab?g[h]=g[h+1]=0:(c=g[h]/b,d=g[h+1]/b,e=c*c+d*d,e>9&&(e=3*b/Math.sqrt(e),g[h]=e*c,g[h+1]=e*d));for(h=-1;++h<=i;)e=(a[Math.min(i,h+1)][0]-a[Math.max(0,h-1)][0])/(6*(1+g[h]*g[h])),f.push([e||0,g[h]*e||0]);return f}function p(a,b,c,d){var e=a[0],f=c[0],g=b[0]-e,h=d[0]-f,i=a[1],j=c[1],k=b[1]-i,l=d[1]-j,m=(h*(i-j)-l*(e-f))/(l*g-h*k);return[e+m*g,i+m*k]}function q(a){return a>1?eb:-1>a?-eb:Math.asin(a)}function r(a){return a.innerRadius}function s(a){return a.outerRadius}function t(a){return a.startAngle}function u(a){return a.endAngle}function v(a){return a&&a.padAngle}function w(a,b,c,d){return(a-c)*b-(b-d)*a>0?0:1}function x(a,b,c,d,e){var f=a[0]-b[0],g=a[1]-b[1],h=(e?d:-d)/Math.sqrt(f*f+g*g),i=h*g,j=-h*f,k=a[0]+i,l=a[1]+j,m=b[0]+i,n=b[1]+j,o=(k+m)/2,p=(l+n)/2,q=m-k,r=n-l,s=q*q+r*r,t=c-d,u=k*n-m*l,v=(0>r?-1:1)*Math.sqrt(t*t*s-u*u),w=(u*r-q*v)/s,x=(-u*q-r*v)/s,y=(u*r+q*v)/s,z=(-u*q+r*v)/s,A=w-o,B=x-p,C=y-o,D=z-p;return A*A+B*B>C*C+D*D&&(w=y,x=z),[[w-i,x-j],[w*c/t,x*c/t]]}function y(){}function z(a){var b=a?a.attr("id"):null;return b||(b="giotto"+ ++sb,a&&a.attr("id",b)),b}function A(b){var c=a.select(H(b.node())),d=c.select("defs");return d.size()||(d=c.append("defs")),d}function B(a){return F(a,"width")}function C(a){return F(a,"height")}function D(a){return G(a,"width")}function E(a){return G(a,"height")}function F(a,b){for(var c,d=a.node?a.node():a;d&&"BODY"!==d.tagName&&!(c=d.getBoundingClientRect()[b]);)d=d.parentNode;return c}function G(b,c){for(var d,e=b.node?b.node():b;e&&"BODY"!==e.tagName;){if(d=e.getBoundingClientRect()[c])return a.select(e);e=e.parentNode}}function H(a){return"svg"===a.tagName.toLowerCase()?a:a.ownerSVGElement}function I(a){var b={},c=a.getScreenCTM(),d=H(a),e=d.createSVGPoint(),f=a.getBBox(),g=f.width,h=f.height;return e.x=f.x,e.y=f.y,b.nw=e.matrixTransform(c),e.x+=g,b.ne=e.matrixTransform(c),e.y+=h,b.se=e.matrixTransform(c),e.x-=g,b.sw=e.matrixTransform(c),e.y-=.5*h,b.w=e.matrixTransform(c),e.x+=g,b.e=e.matrixTransform(c),e.x-=.5*g,e.y-=.5*h,b.n=e.matrixTransform(c),e.y+=h,b.s=e.matrixTransform(c),b}function J(a){function b(h){function i(){var b=a(t),d=a(s.reverse());O(c,b[0],!0),m(c,b,p),O(c,d[0],m.closed),o(c,d,p),c.closePath()}if(c){for(var j,n,q,r=[],s=[],t=[],u=-1,v=h.length,w=e(d),x=e(g),y=d===f?function(){return n}:e(f),z=g===k?function(){return q}:e(k);++u<v;)l.call(b,j=h[u],u)?(s.push([n=+w.call(b,j,u),q=+x.call(b,j,u)]),t.push([+y.call(b,j,u),+z.call(b,j,u)])):s.length&&(i(),s=[],t=[]);return s.length&&i(),r.length?r.join(""):null}}var c,d=h,f=h,g=0,k=i,l=j,m=P,n=m.key,o=m,p=.7;return b.context=function(a){return arguments.length?(c=a,b):c},b.x=function(a){return arguments.length?(d=f=a,b):f},b.x0=function(a){return arguments.length?(d=a,b):d},b.x1=function(a){return arguments.length?(f=a,b):f},b.y=function(a){return arguments.length?(g=k=a,b):k},b.y0=function(a){return arguments.length?(g=a,b):g},b.y1=function(a){return arguments.length?(k=a,b):k},b.defined=function(a){return arguments.length?(l=a,b):l},b.interpolate=function(a){return arguments.length?(n="function"==typeof a?m=a:(m=ob.get(a)||P).key,o=m.reverse||m,b):n},b.tension=function(a){return arguments.length?(p=a,b):p},b}function K(a,b){var c,d,e,f,g,h,i,j,k=a.length,l=new Array(k);for(d=0;k>d;d++)c=d-1,e=d+1,0>c&&(c=k-1),e===k&&(e=0),f=a[c],g=a[d],h=a[e],i=M(f[0],f[1],g[0],g[1],b,!1),j=M(g[0],g[1],h[0],h[1],b,!0),l[d]=[i[0],i[1],g[0],g[1],j[0],j[1]];return l}function M(a,b,c,d,e,f){var g=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),h=f?e/g:(g-e)/g;return[a+h*(c-a),b+h*(d-b)]}function N(a){function b(h){function i(){var b=a(n);O(c,b[0],!0),k(c,b,m)}if(c){for(var j,l=[],n=[],o=-1,p=h.length,q=e(d),r=e(f);++o<p;)g.call(b,j=h[o],o)?n.push([+q.call(b,j,o),+r.call(b,j,o)]):n.length&&(i(),n=[]);return n.length&&i(),l.length?l.join(""):null}}var c,d=h,f=i,g=j,k=P,l=k.key,m=.7;return b.context=function(a){return arguments.length?(c=a,b):c},b.x=function(a){return arguments.length?(d=a,b):d},b.y=function(a){return arguments.length?(f=a,b):f},b.defined=function(a){return arguments.length?(g=a,b):g},b.interpolate=function(a){return arguments.length?(l="function"==typeof a?k=a:(k=ob.get(a)||P).key,b):l},b.tension=function(a){return arguments.length?(m=a,b):m},b}function O(a,b,c){c?(a.beginPath(),a.moveTo(b[0],b[1])):a.lineTo(b[0],b[1])}function P(a,b){for(var c=b[0],d=1;d<b.length;++d)c=b[d],a.lineTo(c[0],c[1])}function Q(a,b){P(a,b),a.closePath()}function R(a,b){var c=b[1],d=b[0],e=.5*(c[0]+d[0]);a.lineTo(e,d[1]),a.lineTo(e,c[1]);for(var f=2;f<b.length;++f)d=c,c=b[f],e=.5*(c[0]+d[0]),a.lineTo(e,d[1]),a.lineTo(e,c[1]);a.lineTo(c[0],c[1])}function S(a,b){for(var c,d=b[0],e=1;e<b.length;++e)c=d,d=b[e],a.lineTo(c[0],d[1]),a.lineTo(d[0],d[1])}function T(a,b){for(var c,d=b[0],e=1;e<b.length;++e)c=d,d=b[e],a.lineTo(d[0],c[1]),a.lineTo(d[0],d[1])}function U(a,b){if(b.length<3)return P(a,b);var c=1,d=b.length,e=b[0],f=e[0],g=e[1],h=[f,f,f,(e=b[1])[0]],i=[g,g,g,e[1]];for(a.lineTo(l(Fa,h),l(Fa,i)),b.push(b[d-1]);++c<=d;)e=b[c],h.shift(),h.push(e[0]),i.shift(),i.push(e[1]),aa(a,h,i);b.pop(),a.lineTo(e[0],e[1])}function V(a,b){if(b.length<4)return P(b);for(var c,d=-1,e=b.length,f=[0],g=[0];++d<3;)c=b[d],f.push(c[0]),g.push(c[1]);for(a.moveTo(l(Fa,f),l(Fa,g)),--d;++d<e;)c=b[d],f.shift(),f.push(c[0]),g.shift(),g.push(c[1]),aa(a,f,g)}function W(a,b){for(var c,d=-1,e=b.length,f=e+4,g=[],h=[];++d<4;)c=b[d%e],g.push(c[0]),h.push(c[1]);for(a.moveTo(l(Fa,g),l(Fa,h)),--d;++d<f;)c=b[d%e],g.shift(),g.push(c[0]),h.shift(),h.push(c[1]),aa(a,g,h)}function X(a,b,c){var d=b.length-1;if(d)for(var e,f,g=b[0][0],h=b[0][1],i=b[d][0]-g,j=b[d][1]-h,k=-1;++k<=d;)e=b[k],f=k/d,e[0]=c*e[0]+(1-c)*(g+f*i),e[1]=c*e[1]+(1-c)*(h+f*j);return U(a,b)}function Y(a,b,c){b.length<3?P(a,b):ba(a,b,m(b,c))}function Z(a,b,c){b.length<4?P(a,b):ba(a,b.slice(1,-1),m(b,c))}function $(a,b,c){b.length<3?P(a,b):ba(a,(b.push(b[0]),b),m([b[b.length-2]].concat(b,[b[1]]),c))}function _(a,b){b.length<3?P(a,b):ba(a,b,o(b))}function aa(a,b,c){a.bezierCurveTo(l(Da,b),l(Da,c),l(Ea,b),l(Ea,c),l(Fa,b),l(Fa,c))}function ba(a,b,c){if(c.length<1||b.length!=c.length&&b.length!=c.length+2)return P(a,b);var d,e,f=b.length!=c.length,g=b[0],h=b[1],i=c[0],j=i,k=1;if(f&&(a.quadraticCurveTo(h[0]-2*i[0]/3,h[1]-2*i[1]/3,h[0],h[1]),g=b[1],k=2),c.length>1){j=c[1],h=b[k],k++,a.bezierCurveTo(g[0]+i[0],g[1]+i[1],h[0]-j[0],h[1]-j[1],h[0],h[1]);for(var l=2;l<c.length;l++,k++)d=h[0]+j[0],e=h[1]+j[1],h=b[k],j=c[l],a.bezierCurveTo(d,e,h[0]-j[0],h[1]-j[1],h[0],h[1])}if(f){var m=b[k];a.quadraticCurveTo(h[0]+2*j[0]/3,h[1]+2*j[1]/3,m[0],m[1])}}function ca(a,b){var c=Math.sqrt(b/bb);a.beginPath(),a.arc(0,0,c,0,cb,!1),a.closePath()}function da(b){function c(b,c){var d=c.datum();if(!d||!d.highlighted)return b.activeOut();var e=c.node();"mouseout"===a.event.type?b.activeOut(e):"mouseout"===a.event.type?b.activeOut(e):b.activeIn(e)}function d(b,c){var d=a.canvas.mouse(c.canvas),e=b.canvasDataAtPoint(d);-1===j.indexOf(c)&&j.push(c),c.paperactive&&c.paperactive.forEach(function(a){-1===e.indexOf(a)&&b.activeOut(a)}),c.paperactive=e.map(function(a){return b.activeIn(a.context(c)),a})}function e(a){return Ua(a.context)}{var f,g=[],h=[],i=[],j=[];b.options()}b.activeOut=function(a){if(arguments.length){-1===i.indexOf(a)&&i.push(a);var c=h.indexOf(a);c>-1&&h.splice(c,1)}else g.forEach(function(a){b.activeOut(a)});return b},b.activeIn=function(a){-1===h.indexOf(a)&&h.push(a);var c=i.indexOf(a);return c>-1&&i.splice(c,1),b},b.task(function(){var c;j.splice(0).forEach(function(b){a.canvas.clear(b)}),i.length&&(i.forEach(function(b){f=g.indexOf(b),f>-1&&g.splice(f,1),e(b)?b.reset():(c=a.select(b),c.datum().reset().render(c))}),b.event("activeout").call(i.splice(0))),h.forEach(function(b){f=g.indexOf(b),-1===f&&(g.push(b),e(b)||(c=a.select(b),c.datum().highLight().render(c)))}),g.forEach(function(a){e(a)&&a.highLight().render()}),h.splice(0).length&&b.event("active").call(g.slice())}),Ca.constants.pointEvents.forEach(function(e){b.on(e,function(){var e=a.select(this);e.size()&&(this.getContext?d(b,this.getContext("2d")):c(b,e))})})}function ea(a,b,c){b.formatX||(b.formatX=fa(a.xaxis())),b.formatY||(b.formatY=fa(a.yaxis()))}function fa(a){var b=a.tickFormat();return b||(b=a.scale().tickFormat?a.scale().tickFormat(1e3):c),b}function ga(a,b,c){var d=++sb;return b=Ca.options(b,c),a.uid=function(){return d},a.event=function(a){return y},a.options=function(c){return arguments.length?(b.extend(c),a):b},a}function ha(b,c,d){var e,f=!1;return ga(b,c,d).load=function(d){c=b.options();var e=c.data;if(delete c.data,e)Ua(e)&&(e=e(b)),b.data(e,d);else{if(c.src&&!f){f=!0;var g=c.src,h=c.loader;return h||(h=a.json,".csv"===g.substring(g.length-4)&&(h=a.csv)),Ca.log.info("Giotto loading data from "+c.src),h(c.src,function(a,c){if(f=!1,1===arguments.length)c=a;else if(a)return Ca.log.error(a);b.data(c,d)})}d&&d()}return b},b.data=function(a,d){return arguments.length?(c=b.options(),c.processData&&(a=c.processData.call(b,a)),e=a,d&&d(),b.event("data").call(b,{type:"data"}),b):e},b}function ia(b,c){var d,e;if(Sa(b)&&(c=b,b=null),b&&Ua(b.node)&&(b=b.node()),b||(b=document.createElement("div")),c){if(c.__paper__===b)return c;d=c.width,e=c.height}else c={};d||(d=B(b),d?c.elwidth=D(b):d=Ca.constants.WIDTH),e?"string"==typeof e&&e.indexOf("%")===e.length-1&&(c.height_percentage=.01*parseFloat(e),e=a.round(c.height_percentage*d)):(e=C(b),e?c.elheight=E(b):e=Ca.constants.HEIGHT),c.size=[d,e],c.giotto="giotto-group",b=a.select(b);var f=b.style("position");return f&&"static"!==f||b.style("position","relative"),c.__paper__=b.node(),c}function ja(a){return a.plugins={},a.pluginArray=[],a.plugin=function(b,c){if(c=Ma({},tb,c),c.name=b,a.plugins[b])throw new Error("not implemented. Cannot override plugin");a.plugins[b]=c,void 0!==c.index?a.pluginArray.splice(c.index,0,c):a.pluginArray.push(c)},a}function ka(a,b){return a.extend=function(c){var d;return Qa(c,function(c,e){"_"!==e.substring(0,1)&&(d=b[e],d?d.extend(a[e],c):a[e]=c)}),a},a.pluginOptions=function(c){if(!arguments.length)return b;if(c.length){Qa(c,function(c){void 0===b[c.name]&&(b[c.name]=c,c.options(a))})}return a},a.copy=function(c){return c&&Ua(c.pluginOptions)?c:ka(Ma({},a),Ma({},b))},a}function la(b,c,d){function f(b){return Ua(b)?b:a.format(b)}var g,j,k,l,m,n,o,p,q=z(),r=h,s=i,t={},u=ub,v=function(a){return a.size};return d=ma(d),p=d.set,d.uid=function(){return q},d.remove=y,d.render=function(){return c?c.apply(d):void 0},d.group=function(){return b},d.draw=function(){return d},d.each=function(a){return k?k.forEach(function(b){a.call(b)}):a.call(d),d},d.renderer=function(a){return 0===arguments.length?c:(c=a,d)},d.options=function(a){return 0===arguments.length?t:(t=a,Ua(t.x)&&d.x(t.x),Ua(t.y)&&d.y(t.y),t.formatX&&(l=f(t.formatX)),t.formatY&&(m=f(t.formatY)),d.init(d,t),d)},d.set=function(a,b){return t[a]=b,p(a,b),k&&u.indexOf(a)>-1&&k.forEach(function(c){c.set(a,b)}),d},d.x=function(a){return 0===arguments.length?r:(r=e(a),d)},d.y=function(a){return 0===arguments.length?s:(s=e(a),d)},d.formatX=function(b){return l||(l=a.format("n")),l(b)},d.formatY=function(b){return m||(m=a.format("n")),m(b)},d.size=function(a){return 0===arguments.length?v:(v=e(a),d)},d.name=function(a){return 0===arguments.length?j:(j=a,d)},d.scalex=function(){var a=b.xaxis().scale();return function(b){return a(r(b))}},d.scaley=function(){var a=b.yaxis().scale();return function(b){return a(s(b))}},d.add=function(a){return o&&(a=o.call(d,[a])),k?k.push(a[0]):k=a,d},d.data=function(a){return arguments.length?(g=!0,k=o?o.call(d,a):a,d):k},d.changed=function(){var a=g;return g=!1,a},d.dataConstructor=function(a){return arguments.length?(o=e(a),d):o},d.label=function(a){return arguments.length?(n=a,d):n},d.pointOptions=function(a){return arguments.length?(u=a,d):u},d}function ma(b){var c={},d=!1;return b||(b={}),b.factor=function(){return b.group().factor()},b.paper=function(){return b.group().paper()},b.highLight=function(){if(d)return b;var e,f=b.active;return f&&(d=!0,b.pointOptions().forEach(function(d){e=f[d],e&&("string"==typeof e&&("darker"===e?e=a.rgb(c[d]).darker():"brighter"===e?e=a.rgb(c[d]).brighter():"%"===e.substring(e.length-1)&&(e=.01*e.substring(0,e.length-1)*c[d])),b[d]=e)})),b},b.highlighted=function(){return d},b.set=function(a,d){return b.pointOptions().indexOf(a)>-1&&(c[a]=d,b[a]=d),b},b.reset=function(){return d=!1,b.pointOptions().forEach(function(a){b[a]=c[a]}),b},b.init=function(a,d,e){var f;return b.pointOptions().forEach(function(b){f=a[b]||d[b],Ua(f)&&e&&(f=f(e)),c[b]=f}),d.active&&b.active!==!1&&(a.active||(a.active={}),Na(d.active,a.active)),b.reset()},b.setBackground=function(a){return b.group().setBackground(b,a),b},b.inRange=y,b}function na(a,b,c){var d=a.options();return c=ma(c),c.data=b,c.options=function(){return d},c.draw=function(){return a},c.group=function(){return a.group()},c.pointOptions=function(){return a.pointOptions()},!b||Va(b)?c.init(c,d):(c.init(b,d,b),c.active=b.active),c}function oa(a,b){return a.attr("fill",b.color).style({"font-size":b.size,"font-weight":b.weight,"font-style":b.style,"font-family":b.family,"font-variant":b.variant})}function pa(a){var b,c=a.reset,d=a.group();return a.inRange=function(){},a.bbox=function(){},a.reset=function(){return b=d.context(),c.call(a)},a.context=function(c){return arguments.length?(b=c,a):b},a}function qa(b,c,d,e,f){function g(a,b,c){return j[c]+.5*k*(a[c]+b[c])}var h=b.paper().element().node(),i=h.getBoundingClientRect(),j=[i.left,i.top],k=1/a.canvas.pixelRatio;return{nw:{x:k*c[0]+j[0],y:k*c[1]+j[1]},ne:{x:k*d[0]+j[0],y:k*d[1]+j[1]},se:{x:k*e[0]+j[0],y:k*e[1]+j[1]},sw:{x:k*f[0]+j[0],y:k*f[1]+j[1]},n:{x:g(c,d,0),y:g(c,d,1)},s:{x:g(f,e,0),y:g(f,e,1)},e:{x:g(e,d,0),y:g(e,d,1)},w:{x:g(f,c,0),y:g(f,c,1)}}}function ra(a,b){if(!a.__init__){a.__init__=!0,b&&b();var c=a.options();c.onInit&&(b=Xa(c.onInit),Ua(b)?b(a,c):Ca.log.error("Could not locate onInit function "+c.onInit))}return a}function sa(a){function b(){var a=d.active;if(!a.length)return d.hide();var b=c(a[0]),e=b.tooltip||"n";if(a.length>1){e="e";for(var f=1;f<a.length;++f){var g=c(a[f]);b[e].y+=g[e].y}b[e].y/=a.length}d.bbox(b).direction(e).show()}function c(a){return Ua(a.bbox)?a.bbox():I(a)}var d,e=a.options();a.showTooltip=function(){return d||(d=ta(e).offset(e.tooltip.offset)),b(),a},a.hideTooltip=function(){return d&&d.hide(),a},a.removeTooltip=function(){return d&&d.hide(),e.tooltip.show=!1,d=null,a},a.on("active.tooltip",function(){d&&(d.active=this,b())}).on("activeout.tooltip",function(){d&&(d.active.splice(0),d.hide())}),a.task(function(){e.tooltip.show&&b()}),e.tooltip.show&&a.showTooltip()}function ta(b){function c(a){var b=a.options();return b.tooltip?b.tooltip.template||d.template:d.template}var d=b.tooltip,e=Ma({},b.font,d.font),f=Ca.tip();return f.active=[],f.attr("class",d.className).style({background:d.fill,opacity:d.fillOpacity,color:d.color,padding:d.padding,"border-radius":d.radius,font:_a(e)}),"d3-tip"===d.className&&vb&&(vb["d3-tip:after"].color=d.fill,Ya("",vb),vb=null),f.html(function(){for(var b,d,e,g="",h=0;h<f.active.length;++h)b=f.active[h],b.draw||(b=a.select(b).datum()),d=b.draw(),e=c(d),g+=e({c:b.color,l:d.label()||"serie",x:d.formatX(d.x()(b.data)),y:d.formatY(d.y()(b.data))});return g}),f}function ua(a,b){if(b){var c,d,e,f,g=a.options(),h=a.allranges(),i=Ma({},g.serie);if(Ca.data.isData(b)||(Ma(i,b),b=i.data,delete i.data,b)){if(i.index=a.numSeries(),i.label||(i.label="serie "+i.index),g.chartTypes.forEach(function(a){var b=i[a];Va(b)&&!i.data&&(i.data=b,b={}),(b||g[a]&&g[a].show)&&(i[a]=Ma({},g[a],b),e=!0)}),e||(i.line=Ma({},g.line)),g.chartTypes.forEach(function(b){var c=i[b];c&&wb[b].scaled&&(d||(d=a.drawColor(c)),c.color||(c.color=d),f=!0)}),f){void 0===i.yaxis&&(i.yaxis=1),i.axisgroup||(i.axisgroup=1);var j=h[i.axisgroup];j||(i.reference=!0,h[i.axisgroup]=j={}),Sa(i.xaxis)||(i.xaxis=g.xaxis),2===i.yaxis&&(i.yaxis=g.yaxis2),Sa(i.yaxis)||(i.yaxis=g.yaxis)}return i.group=function(){return c},i.clear=function(){return c&&c.remove(),c=null,i},i.data=function(a){if(!arguments.length)return b;if(f){var c,d=h[i.axisgroup],e=d[i.xaxis.position],j=xb(a,i.x,i.y);a=j.data,e?(e.range[0]=Math.min(e.range[0],j.xrange[0]),e.range[1]=Math.max(e.range[1],j.xrange[1])):(d[i.xaxis.position]=e={range:j.xrange,ordinal:j.xordinal,serie:i},i.drawXaxis=!0),e=d[i.yaxis.position],e?(e.range[0]=Math.min(e.range[0],j.yrange[0]),e.range[1]=Math.max(e.range[1],j.yrange[1])):(d[i.yaxis.position]=e={range:j.yrange,ordinal:j.yordinal,serie:i},i.drawYaxis=!0)}return b=a,g.chartTypes.forEach(function(a){c=i[a],c&&Ua(c.data)&&c.data(b)}),i},i.draw=function(){function d(a,d){var e=h[i.axisgroup][a.orient()],f=a.options(),g=a.scale();return e.ordinal&&(g=c.ordinalScale(a)),e.scale=g,g.rangeBand?g.domain(b.map(function(a){return a[d]})):f.auto?(g.domain([e.range[0],e.range[1]]).nice(),Wa(f.min)?Wa(f.max)||g.domain([g.domain()[0],f.max]):g.domain([f.min,g.domain()[1]])):g.domain([f.min,f.max]),c}function e(a){if(i.axisgroup){var b=h[i.axisgroup][a.orient()];a.scale(b.scale)}}var f,g=a.options();return c?(g.chartTypes.forEach(function(a){f=i[a],f&&i[a].label(i.label)}),i.drawXaxis?d(c.xaxis()):e(c.xaxis()),i.drawYaxis?d(c.yaxis()):e(c.yaxis())):(g.chartTypes.forEach(function(a){f=i[a],f&&(Ua(f.options)&&(f=f.options()),i[a]=f)}),c=a.paper().classGroup(Za(i.label),Ma({},i)),i.reference&&c.element().classed("reference",!0).classed(a.axisGroupId(i.axisgroup),!0),i.drawXaxis?d(c.xaxis(),"x").drawXaxis():i.axisgroup&&e(c.xaxis()),i.drawYaxis?d(c.yaxis(),"y").drawYaxis():i.axisgroup&&e(c.yaxis()),g.chartTypes.forEach(function(a){f=i[a],f&&(i[a]=wb[a](c,i.data(),f).label(i.label))})),i},i.data(b)}}}function va(a){function b(b,c,d){return a(b,c,d).x(function(a){return a.x}).y(function(a){return a.y})}return b.scaled=!0,b}function wa(){return""}function xa(b,c,d){var e,f,g=b.type(),h=a.bisector(function(a){return a.sx}).left;return d=la(b,c,d),d.bisector=a.bisector(function(a){return a.sx}).left,d.each=function(a){return a.call(d),d},d.path_line=function(){var b=d.options();return a[g].line().interpolate(b.interpolate).x(function(a){return a.sx}).y(function(a){return a.sy})},d.path_area=function(){var c=d.options(),e=b.yaxis().scale();return a[g].area().interpolate(c.interpolate).x(function(a){return a.sx}).y0(e(e.domain()[0])).y1(function(a){return a.sy})},d.path_data=function(){var c=d.x(),h=d.y(),i=b.xaxis().scale(),j=b.yaxis().scale();return f=null,d.symbol=a[g].symbol().type(function(a){return a.symbol||"circle"}).size(d.size()),e=d.data().map(function(a,b){var d={x:c(a),y:h(a),index:b,data:a};return d.sx=i(d.x),d.sy=j(d.y),d})},d.bisect=function(b){if(!f&&e&&(f=e.slice().sort(function(b,c){return a.ascending(b.sx,c.sx)})),f){var c=h(f,b);if(c<f.length)return f[c]}},d}function ya(b,c){function d(){var c=[],d=i.options();return f.forEach(function(e){if(Ua(e)&&Ua(e.data)){var f=e.data(i.data())([]),g=e.scale(),j=a.scale.quantize().domain(g.range()).range(b.options().colors);f.forEach(function(a){a.data?a.fill=j(g(a.data[1])):(a.active=!1,a.fill=d.missingFill),c.push(h(i,a.data,a))})}else e.active=!1,c.push(h(i,null,e))}),c}var e,f,g=a.geo.path(),h=Ca[b.type()].feature,i=la(b,c);return i.path=function(){var c,d=i.options(),e=Math.round(.5*b.innerWidth()),f=Math.round(.5*b.innerHeight()),h=Math.round(d.scale*Math.min(e,f));if(d.projection&&(c=d.projection,Ta(c))){if(Ca.geo[c])return Ca.geo[c](i,g),g;c=a.geo[c]}return c||(c=a.geo.mercator),c=c().scale(h).translate([e,f]),g.projection(c)},i.features=function(a){return arguments.length?(f=a,e=null,i):f},i.graticule=function(){var c={object:a.geo.graticule()()};return Ma(c,b.options().grid,i.options().grid)},i.dataFeatures=function(){return!f||!i.changed()&&e||(e=d()),e},i}function za(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function Aa(b,c,d){var e=Va(c)?d:c,f=b.group(),g=f.factor(),h=f.paper().element().node();return e.fill=e.fill||b.group().pickColor(),e.color=e.color||a.rgb(e.fill).darker().toString(),d=na(b,c,d),"canvas"===f.type()&&(d=pa(d)),d.bbox=function(){function a(a){return Math.round(s*(q+a)+c.left)}function b(a){return Math.round(s*(r-a)+c.top)}var c=h.getBoundingClientRect(),e=Math.sin(d.startAngle),i=Math.cos(d.startAngle),j=Math.sin(d.endAngle),k=Math.cos(d.endAngle),l=Math.sin(.5*(d.startAngle+d.endAngle)),m=Math.cos(.5*(d.startAngle+d.endAngle)),n=d.innerRadius,o=d.outerRadius,p=.5*(n+o),q=f.marginLeft()+.5*f.innerWidth(),r=f.marginTop()+.5*f.innerHeight(),s=1/g;return{nw:{x:a(o*e),y:b(o*i)},ne:{x:a(o*j),y:b(o*k)},se:{x:a(n*j),y:b(n*k)},sw:{x:a(n*e),y:b(n*i)},w:{x:a(p*e),y:b(p*i)},n:{x:a(o*l),y:b(o*m)},e:{x:a(p*j),y:b(p*k)},s:{x:a(n*l),y:b(n*m)},c:{x:a(p*l),y:b(p*m)},tooltip:"s"}},d}var Ba={version:"0.2.0",d3:a,math:{},svg:{},canvas:{},geo:{},data:{}},Ca=Ba;a.giotto=Ba,a.canvas={};var Da=[0,2/3,1/3,0],Ea=[0,1/3,2/3,0],Fa=[0,1/6,2/3,1/6],Ga="auto",Ha={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Ia=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];Ca.data.fromcsv=function(a){for(var b,c,d=a[0],e=[],f=1;f<a.length;++f){for(b={},c=0;c<d.length;++c)b[d[c]]=a[f][c];e.push(b)}return e},Ca.data.multi=function(b){function c(a){return function(b){return b[a]}}var d={};return d.serie=function(){var a,d,e={};return e.x=function(b){return arguments.length?(Ua(b)||(b=c(b)),a=b,e):a},e.y=function(a){return arguments.length?(Ua(a)||(a=c(a)),d=a,e):d},e.forEach=function(c){return b&&b.forEach(function(b){c([a(b),d(b)])}),e},e.all=function(){return b?b.map(function(b){return[a(b),d(b)]}):[]},e.isData=j,e},d.map=function(d,e){return Ua(d)||(d=c(d)),Ua(e)||(e=c(e)),a.map(b.map(e),d)},d.isData=j,d},Ca.data.isData=function(a){return Sa(a)&&Ca.data.isData(a.data)?!1:a?!0:!1};var Ja=function(a){function b(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function c(a){var c=window.console||{},d=c[a]||c.log||y,e=!1;try{e=!!d.apply}catch(f){}return e?function(){for(var a=[],e=0;e<arguments.length;++e)a.push(b(arguments[e]));return d.apply(c,a)}:function(a,b){d(a,null===b?"":b)}}return{log:c("log"),info:c("info"),warn:c("warn"),error:c("error"),debug:function(){var b=c("debug");return function(){a&&b.apply(self,arguments)}}()}};Ca.log=Ja(b.debug);{var Ka=Object.prototype.toString,La=Ca._={},Ma=Ca.extend=La.extend=function(){var a,b=arguments.length,c=arguments[0],d=0,e=!1;if(c===!0&&(e=!0,c=arguments[1],d++),!c||d+2>b)return c;for(;++d<b;)if(a=arguments[d],Object(a)===a)for(var f in a)a.hasOwnProperty(f)&&(e&&Sa(a[f])?Sa(c[f])?Ma(!0,c[f],a[f]):c[f]=Ma(!0,{},a[f]):c[f]=a[f]);return c},Na=La.copyMissing=function(a,b,c){if(a&&b){var d,e;for(var f in a)a.hasOwnProperty(f)&&(e=a[f],d=b[f],c&&Sa(e)&&e!==d?(Sa(d)||(d={}),Na(e,d,c),b[f]=d):void 0===d&&(b[f]=e))}return b},Oa=function(a){for(var c=b,d=a.split("."),e=0;e<d.length&&(c=c[d[e]],c);++e);return c},Pa=function(a){var b;return a&&"string"==typeof a.options&&(b=Oa(a.options),"function"==typeof b&&(b=b())),b||(b={}),Sa(b)&&Qa(a,function(a,c){"$"!==c.substring(0,1)&&"options"!==c&&(b[c]=a)}),b},Qa=(La.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},La.size=function(a){if(a){if(void 0!==a.length)return a.length;if(La.isObject(a)){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}return 0}return 0},La.forEach=La.each=function(a,b){if(a){if(a.forEach)return a.forEach(b);for(var c in a)a.hasOwnProperty(c)&&b(a[c],c)}}),Ra=(La.pick=function(a,b){var c,d={};for(var e in a)a.hasOwnProperty(e)&&(c=b(a[e],e),void 0!==c&&(d[e]=c));return d},La.extendArray=function(){if(arguments.length){var a=arguments[0],b=function(b){a.push(b)};if("function"==typeof a.push)for(var c=1;c<arguments.length;++c)Qa(arguments[c],b);return a}}),Sa=La.isObject=function(a){return"[object Object]"===Ka.call(a)},Ta=La.isString=function(a){return"[object String]"===Ka.call(a)},Ua=La.isFunction=function(a){return"[object Function]"===Ka.call(a)},Va=La.isArray=function(a){return"[object Array]"===Ka.call(a)},Wa=(La.isDate=function(a){return"[object Date]"===Ka.call(a)},La.isNull=function(a){return void 0===a||null===a}),Xa=(La.encodeObject=function(a,b){var c;if("multipart/form-data"===b){var d=new FormData;for(c in a)a.hasOwnProperty(c)&&d.append(c,a[c]);return d}if("application/json"===b)return JSON.stringify(a);var e=[];for(c in a)a.hasOwnProperty(c)&&e.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return e.join("&")},La.getObject=function(a){if(La.isString(a)){var c=a.split(".");a=b;for(var d=0;d<c.length&&(a=a[c[d]],a);++d);}return a}),Ya=(La.loadCss=function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("href",a),document.getElementsByTagName("head")[0].appendChild(b)},La.addCss=function(a,b){function c(a,b){var e,f=[];for(var g in b)b.hasOwnProperty(g)&&(e=b[g],La.isObject(e)?c(a+" ."+g,e):f.push("    "+g+": "+e+";"));f.length&&d.push(a+" {\n"+f.join("\n")+"\n}")}var d=[];if(c(a,b),d.length){d=d.join("\n");var e=document.createElement("style");return e.innerHTML=d,document.getElementsByTagName("head")[0].appendChild(e),e}}),Za=La.slugify=function(a){a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase();for(var b="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",c="aaaaeeeeiiiioooouuuunc------",d=0,e=b.length;e>d;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},$a=["style","variant","weight","size","family"],_a=La.fontString=function(a){for(var b,c=[],d=0;d<$a.length;++d)b=a[$a[d]],b&&c.push(b);return c.join(" ")};La.now=function(){return Date.now?Date.now():(new Date).getTime()}}Ca.math.distances={euclidean:function(a,b){for(var c=0,d=0;d<a.length;d++)c+=Math.pow(b[d]-a[d],2);return Math.sqrt(c)}},Ca.math.kmeans=function(a,b,c){var d={};return b=b||300,c=c||"euclidean","string"==typeof c&&(c=Ca.math.distances[c]),d.centroids=function(b){return arguments.length?(a=b,d):a},d.maxIters=function(a){return arguments.length?(b=+a,d):b},d.randomCentroids=function(a,b){var c=a.slice(0);return c.sort(function(){return Math.round(Math.random())-.5}),c.slice(0,b)},d.classify=function(b){var d,e,f=1/0,g=0;for(d=0;d<a.length;d++)e=c(b,a[d]),f>e&&(f=e,g=d);return g},d.cluster=function(c,e){var f,g,h,i=0,j=!0,k=c.length,l=a.length,m=new Array(l);if(l>k)throw Error("Number of points less than the number of clusters in K-means classification");for(;j&&b>i;){for(j=!1,++i,h=0;l>h;++h)m[h]={centroid:a[h],points:[],indices:[]};for(g=0;k>g;g++)h=d.classify(c[g]),m[h].points.push(c[g]),m[h].indices.push(g);for(f=[],h=0;l>h;++h){if(!m[h].points.length){f=d.randomCentroids(c,l);break}f.push(Ca.math.mean(m[h].points))}for(h=0;l>h;++h)if(f[h]!=a[h]){a=f,j=!0;break}e&&e(m,i)}return m},d};var ab=1e-6,bb=Math.PI,cb=2*bb,db=cb-ab,eb=bb/2,fb=bb/180,gb=Math.abs;Ca.math.xyfunction=function(a,b){var c=[];return Va(a)&&a.forEach(function(a){c.push([a,b(a)])}),c},Ca.math.mean=function(a){var b,c,d,e=a[0].slice(0);for(c=1;c<a.length;++c)for(b=a[c],d=0;d<e.length;++d)e[d]+=b[d];for(d=0;d<e.length;++d)e[d]/=a.length;return e};var hb=52,ib=2<<51,jb=21201,kb=["d       s       a       m_i","2       1       0       1","3       2       1       1 3","4       3       1       1 3 1","5       3       2       1 1 1","6       4       1       1 1 3 3","7       4       4       1 3 5 13","8       5       2       1 1 5 5 17","9       5       4       1 1 5 5 5","10      5       7       1 1 7 11 1"];Ca.math.sobol=function(a){if(1>a||a>jb)throw new Error("Out of range dimension");var b,c,d={},e=0,f=[],g=[],h=[];d.next=function(){var b=[];if(0===e)return e++,h.slice();for(var d=1,i=e-1;1==(1&i);)i>>=1,d++;for(c=0;a>c;c++)g[c]^=f[c][d],b[c]=g[c]/ib;return e++,b},d.dimension=function(){return a},d.count=function(){return e};var i=[];for(c=0;hb>=c;c++)i.push(0);for(c=0;a>c;c++)f[c]=i.slice(),g[c]=0,h[c]=0;if(a>kb.length)throw new Error("Out of range dimension");for(b=kb,c=1;hb>=c;c++)f[0][c]=1<<hb-c;for(var j=1;a>j;j++){var k=b[j].split(/\s+/),l=+k[1],m=+k[2],n=[0];for(c=0;l>c;c++)n.push(+k[3+c]);for(c=1;l>=c;c++)f[j][c]=n[c]<<hb-c;for(c=l+1;hb>=c;c++){f[j][c]=f[j][c-l]^f[j][c-l]>>l;for(var o=1;l-1>=o;o++)f[j][c]^=(m>>l-1-o&1)*f[j][c-o]}}return d},a.canvas.arc=function(){function a(){var d=Math.max(0,+c.apply(a,arguments)),e=Math.max(0,+f.apply(a,arguments)),l=i.apply(a,arguments)-eb,m=j.apply(a,arguments)-eb,n=Math.abs(m-l),o=l>m?0:1;if(d>e&&(r=e,e=d,d=r),b.beginPath(),n>=db)return b.arc(0,0,e,0,cb,!1),d&&b.arc(0,0,d,0,cb,!0),void b.closePath();var r,s,t,u,v,y,z=(+k.apply(a,arguments)||0)/2,A=0,B=0,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null;if(z&&(t=h===Ga?Math.sqrt(d*d+e*e):+h.apply(a,arguments),o||(B*=-1),e&&(B=q(t/e*Math.sin(z))),d&&(A=q(t/d*Math.sin(z)))),e){if(C=e*Math.cos(l+B),D=e*Math.sin(l+B),E=e*Math.cos(m-B),F=e*Math.sin(m-B),y=Math.abs(m-l-2*B)<=bb?0:1,B&&w(C,D,E,F)===o^y){var K=(l+m)/2;C=e*Math.cos(K),D=e*Math.sin(K),E=F=null}}else C=D=0;if(d){if(G=d*Math.cos(m-A),H=d*Math.sin(m-A),I=d*Math.cos(l+A),J=d*Math.sin(l+A),v=Math.abs(l-m+2*A)<=bb?0:1,A&&w(G,H,I,J)===1-o^v){var L=(l+m)/2;G=d*Math.cos(L),H=d*Math.sin(L),I=J=null}}else G=H=0;if((r=Math.min(Math.abs(e-d)/2,+g.apply(a,arguments)))>.001){s=e>d^o?0:1;var M=null===I?[G,H]:null===E?[C,D]:p([C,D],[I,J],[E,F],[G,H]),N=C-M[0],O=D-M[1],P=E-M[0],Q=F-M[1],R=1/Math.sin(Math.acos((N*P+O*Q)/(Math.sqrt(N*N+O*O)*Math.sqrt(P*P+Q*Q)))/2),S=Math.sqrt(M[0]*M[0]+M[1]*M[1]);if(null!==E){var T=Math.min(r,(e-S)/(R+1)),U=x(null===I?[G,H]:[I,J],[C,D],e,T,o),V=x([E,F],[G,H],e,T,o);r===T?(u=1-o^w(U[1][0],U[1][1],V[1][0],V[1][1]),lb(b,U[0],U[1],T,0,s),lb(b,U[1],V[1],e,u,o),lb(b,V[1],V[0],T,0,s)):lb(b,U[0],V[0],T,1,s)}else b.moveTo(C,D);if(null!==I){var W=Math.min(r,(d-S)/(R-1)),X=x([C,D],[I,J],d,-W,o),Y=x([G,H],null===E?[C,D]:[E,F],d,-W,o);b.lineTo(Y[0][0],Y[0][1]),r===W?(u=o^w(Y[1][0],Y[1][1],X[1][0],X[1][1]),b.lineTo(Y[0][0],Y[0][1]),lb(b,Y[0],Y[1],W,0,s),lb(b,Y[1],X[1],d,u,1-o),lb(b,X[1],X[0],W,0,s)):lb(b,Y[0],X[0],W,0,s)}else b.lineTo(G,H)}else null!==E&&lb(b,[C,D],[E,F],e,y,o),b.lineTo(G,H),null!==I&&lb(b,[G,H],[I,J],d,v,1-o);b.closePath()}var b,c=r,f=s,g=d,h=Ga,i=t,j=u,k=v;return a.context=function(c){return arguments.length?(b=c,a):b},a.innerRadius=function(b){return arguments.length?(c=e(b),a):c},a.outerRadius=function(b){return arguments.length?(f=e(b),a):f},a.cornerRadius=function(b){return arguments.length?(g=e(b),a):g},a.padRadius=function(b){return arguments.length?(h=b==Ga?Ga:e(b),a):h},a.startAngle=function(b){return arguments.length?(i=e(b),a):i},a.endAngle=function(b){return arguments.length?(j=e(b),a):j},a.padAngle=function(b){return arguments.length?(k=e(b),a):k},a.centroid=function(){var b=(+c.apply(a,arguments)+f.apply(a,arguments))/2,d=(+i.apply(a,arguments)+j.apply(a,arguments))/2-eb;return[Math.cos(d)*b,Math.sin(d)*b]},a};var lb=a.canvas.drawArc=function(a,b,c,d,e,f){var g=b[0]-c[0],h=b[1]-c[1],i=g*g+h*h,j=Math.sqrt(i),k=.5*(b[0]+c[0]),l=.5*(b[1]+c[1]),m=Math.sqrt(d*d-.25*i);

f>0?(k+=m*h/j,l-=m*g/j):(k-=m*h/j,l+=m*g/j);var n=Math.atan2(b[1]-l,b[0]-k),o=Math.atan2(c[1]-l,c[0]-k);a.arc(k,l,d,n,o,0>=f)};a.canvas.area=function(){return J(c)},a.canvas.axis=function(){function b(a){a.each(function(){var a,b=this.getContext("2d"),o=this.__chart__||d,p=this.__chart__=d.copy(),q=null===k?p.ticks?p.ticks.apply(p,j):p.domain():k,r=null===l?p.tickFormat?p.tickFormat.apply(p,j):c:l,s=Math.max(f,0)+i,t="top"===e||"left"===e?-1:1,u=g(p);if(p.rangeBand){var v=p,w=v.rangeBand()/2;o=p=function(a){return v(a)+w}}else o.rangeBand&&(o=p);"bottom"===e||"top"===e?(b.textBaseline=0>t?"bottom":"top",b.textAlign=n||"center",b.moveTo(u[0],0),b.lineTo(u[1],0),b.moveTo(u[0],0),b.lineTo(u[0],t*h),b.moveTo(u[1],0),b.lineTo(u[1],t*h),q.forEach(function(c,d){a=p(c),b.moveTo(a,0),b.lineTo(a,t*f),m?(b.save(),b.translate(a,t*s),b.rotate(m),b.fillText(r(c),0,0),b.restore()):b.fillText(r(c),a,t*s)})):(b.textBaseline="middle",b.textAlign=n||(0>t?"end":"start"),b.moveTo(0,u[0]),b.lineTo(0,u[1]),b.moveTo(0,u[0]),b.lineTo(t*h,u[0]),b.moveTo(0,u[1]),b.lineTo(t*h,u[1]),q.forEach(function(c,d){a=p(c),b.moveTo(0,a),b.lineTo(t*f,a),m?(b.save(),b.rotate(m),b.fillText(r(c),t*s,a),b.restore()):b.fillText(r(c),t*s,a)}))})}var d=a.scale.linear(),e=mb,f=6,h=6,i=3,j=[10],k=null,l=null,m=0,n=null;return b.scale=function(a){return arguments.length?(d=a,b):d},b.orient=function(a){return arguments.length?(e=a in nb?a+"":mb,b):e},b.ticks=function(){return arguments.length?(j=arguments,b):j},b.tickValues=function(a){return arguments.length?(k=a,b):k},b.tickFormat=function(a){return arguments.length?(l=a,b):l},b.tickSize=function(a){var c=arguments.length;return c?(f=+a,h=+arguments[c-1],b):f},b.innerTickSize=function(a){return arguments.length?(f=+a,b):f},b.outerTickSize=function(a){return arguments.length?(h=+a,b):h},b.tickPadding=function(a){return arguments.length?(i=+a,b):i},b.tickSubdivide=function(){return arguments.length&&b},b.textRotate=function(a){return arguments.length?(m=+a,b):m},b.textAlign=function(a){return arguments.length?(n=a,b):n},b};var mb="bottom",nb={top:1,right:1,bottom:1,left:1};a.canvas.brush=function(){function b(b){b.each(function(){a.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",j).on("touchstart.brush",j).on("mousemove.brushover",i),p.brushstart.call(this),p.brush.call(this),p.brushend.call(this),c(this.getContext("2d"))})}function c(a){m&&(d(a),a.fillStyle=m,a.fill())}function d(a){var b,c;a.beginPath(),q&r?(b=q(extent[0][0]),c=r(extent[1][0])):q?(b=s[0],a.rect(b+x[0],x[1],s[1]-b,x[3]||a.canvas.height)):r&&a.rect(0,extent[0][0],a.canvas.width,extent[0][1]-extent[0][0])}function f(a,b){}function h(a,b){var c=s[b];a.beginPath(),a.rect(c-z+x[0],x[1],2*z,x[3]||a.canvas.height)}function i(){var b=a.select(this),c=this.getContext("2d"),e=a.canvas.mouse(this),f=e[0],g=e[1],i="";r&&(n(c,0),c.isPointInPath(f,g)?i="s":(n(c,1),c.isPointInPath(f,g)&&(i="n"))),q&&(o(c,0),c.isPointInPath(f,g)?i+="w":(h(c,1),c.isPointInPath(f,g)&&(i+="e"))),d(c),i?b.style("cursor",Ha[i]).datum(i).classed("extent",!1):c.isPointInPath(f,g)?b.style("cursor","move").classed("extent",!0).datum(""):b.style("cursor","crosshair").classed("extent",!1).datum("")}function j(){function b(){32==a.event.keyCode&&(A||(i=null,o[0]-=s[1],o[1]-=t[1],A=2),a.event.preventDefault())}function d(){32==a.event.keyCode&&2==A&&(o[0]+=s[1],o[1]+=t[1],A=0,a.event.preventDefault())}function e(){var b=a.canvas.mouse(m);a.canvas.clear(n),j&&(b[0]+=j[0],b[1]+=j[1]),A||(a.event.altKey?(i||(i=[(s[0]+s[1])/2,(t[0]+t[1])/2]),o[0]=s[+(b[0]<i[0])],o[1]=t[+(b[1]<i[1])]):i=null);var d={type:"brush"};(y&&f(b,q,0)||z&&f(b,r,1))&&(d.mode=A?"move":"resize"),p.brush.call(n,{type:"brush",mode:A?"move":"resize"}),c(n)}function f(a,b,c){var d,e,f=g(b),h=f[0],j=f[1],m=o[c],n=c?t:s,p=n[1]-n[0];return A&&(h-=m,j-=p+m),d=(c?v:u)?Math.max(h,Math.min(j,a[c])):a[c],A?e=(d+=m)+p:(i&&(m=Math.max(h,Math.min(j,2*i[c]-d))),d>m?(e=d,d=m):e=m),n[0]!=d||n[1]!=e?(c?l=null:k=null,n[0]=d,n[1]=e,!0):void 0}function h(){e(),a.select("body").style("cursor",null),B.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),p.brushend.call(n,{type:"brushend"})}var i,j,m=this,n=m.getContext("2d"),o=a.canvas.mouse(m),w=a.select(m),x=w.datum(),y=!/^(n|s)$/.test(x)&&q,z=!/^(e|w)$/.test(x)&&r,A=w.classed("extent"),B=a.select(window).on("keydown.brush",b).on("keyup.brush",d);if(a.event.changedTouches?B.on("touchmove.brush",e).on("touchend.brush",h):B.on("mousemove.brush",e).on("mouseup.brush",h),w.interrupt().selectAll("*").interrupt(),A)o[0]=s[0]-o[0],o[1]=t[0]-o[1];else if(x){var C=+/w$/.test(x),D=+/^n/.test(x);j=[s[1-C]-o[0],t[1-D]-o[1]],o[0]=s[C],o[1]=t[D]}else a.event.altKey&&(i=o.slice());a.select("body").style("cursor",w.style("cursor")),p.brushstart({type:"brushstart"}),e()}var k,l,m,n,o,p=a.dispatch("brushstart","brush","brushend"),q=null,r=null,s=[0,0],t=[0,0],u=!0,v=!0,w=Ia[0],x=[0,0,0,0],y=window.devicePixelRatio||1,z=3*y;return b.draw_sn=function(a){return arguments.length?(n=e(a),b):n},b.draw_we=function(a){return arguments.length?(o=e(a),b):o},b.fillStyle=function(a){return arguments.length?(m=a,b):m},b.rect=function(a){return arguments.length?(x=a,b):x},b.x=function(a){return arguments.length?(q=a,w=Ia[!q<<1|!r],b):q},b.y=function(a){return arguments.length?(r=a,w=Ia[!q<<1|!r],b):r},b.clamp=function(a){return arguments.length?(q&&r?(u=!!a[0],v=!!a[1]):q?u=!!a:r&&(v=!!a),b):q&&r?[u,v]:q?u:r?v:null},b.extent=function(a){var c,d,e,f,g;return arguments.length?(q&&(c=a[0],d=a[1],r&&(c=c[0],d=d[0]),k=[c,d],q.invert&&(c=q(c),d=q(d)),c>d&&(g=c,c=d,d=g),(c!=s[0]||d!=s[1])&&(s=[c,d])),r&&(e=a[0],f=a[1],q&&(e=e[1],f=f[1]),l=[e,f],r.invert&&(e=r(e),f=r(f)),e>f&&(g=e,e=f,f=g),(e!=t[0]||f!=t[1])&&(t=[e,f])),b):(q&&(k?(c=k[0],d=k[1]):(c=s[0],d=s[1],q.invert&&(c=q.invert(c),d=q.invert(d)),c>d&&(g=c,c=d,d=g))),r&&(l?(e=l[0],f=l[1]):(e=t[0],f=t[1],r.invert&&(e=r.invert(e),f=r.invert(f)),e>f&&(g=e,e=f,f=g))),q&&r?[[c,e],[d,f]]:q?[c,d]:r&&[e,f])},b.clear=function(){return b.empty()||(s=[0,0],t=[0,0],k=l=null),b},b.empty=function(){return!!q&&s[0]==s[1]||!!r&&t[0]==t[1]},b.draw_sn(f).draw_we(h),a.rebind(b,p,"on")},a.canvas.pixelRatio=window.devicePixelRatio||1,a.canvas.webgl=function(a){arguments.length||(a=document.createElement("canvas"));try{return a.getContext("webgl")||a.getContext("experimental-webgl")}catch(b){return}},a.canvas.clear=function(a){a.beginPath(),a.closePath(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,a.canvas.width,a.canvas.height)},a.canvas.retinaScale=function(b,c,d){return b.canvas.width=c,b.canvas.height=d,window.devicePixelRatio&&(b.canvas.style.width=c+"px",b.canvas.style.height=d+"px",b.canvas.width=c*window.devicePixelRatio,b.canvas.height=d*window.devicePixelRatio,b.scale(window.devicePixelRatio,window.devicePixelRatio)),a.canvas.clear(b),a.canvas.pixelRatio},a.canvas.resize=function(b,c,d){return b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,b.canvas.width,b.canvas.height),a.canvas.retinaScale(b,c,d)},a.canvas.style=function(b,c){c.fill&&(b.fillStyle=a.canvas.rgba(c.fill,c.fillOpacity),b.fill()),c.color&&c.lineWidth&&(b.strokeStyle=a.canvas.rgba(c.color,c.colorOpacity),b.lineWidth=a.canvas.pixelRatio*c.lineWidth,b.stroke())},a.canvas.drawPolygon=function(a,b,c){c>0&&(b=K(b,c));var d,e,f=b.length;for(a.beginPath(),d=0;f>d;d++)e=b[d],0===d?a.moveTo(e[0],e[1]):a.lineTo(e[0],e[1]),c>0&&a.quadraticCurveTo(e[2],e[3],e[4],e[5]);a.closePath()},a.canvas.rgba=function(b,c){if(1>c){var d=a.rgb(b);return"rgba("+d.r+","+d.g+","+d.b+","+c+")"}return b},a.canvas.mouse=function(b){var c=a.mouse(b);return b.getContext&&window.devicePixelRatio&&(c[0]*=window.devicePixelRatio,c[1]*=window.devicePixelRatio),c},a.canvas.line=function(){return N(c)};var ob=a.map({linear:P,"linear-closed":Q,step:R,"step-before":S,"step-after":T,basis:U,"basis-open":V,"basis-closed":W,bundle:X,cardinal:Y,"cardinal-open":Z,"cardinal-closed":$,monotone:_});S.reverse=T,T.reverse=S,a.canvas.symbol=function(){function b(a,d){return(pb.get(f.call(b,a,d))||ca)(c,g.call(b,a,d))}var c,d=a.svg.symbol(),f=d.type(),g=d.size();return b.type=function(a){return arguments.length?(f=e(a),b):f},b.size=function(a){return arguments.length?(g=e(a),b):g},b.context=function(a){return arguments.length?(c=a,b):c},b};var pb=a.map({circle:ca,cross:function(a,b){var c=Math.sqrt(b/5)/2,d=3*c;a.beginPath(),a.moveTo(-d,-c),a.lineTo(-c,-c),a.lineTo(-c,-d),a.lineTo(c,-d),a.lineTo(c,-c),a.lineTo(d,-c),a.lineTo(d,c),a.lineTo(c,c),a.lineTo(c,d),a.lineTo(-c,d),a.lineTo(-c,c),a.lineTo(-d,c),a.closePath()},diamond:function(a,b){var c=Math.sqrt(b/(2*rb)),d=c*rb;a.beginPath(),a.moveTo(0,-c),a.lineTo(d,0),a.lineTo(0,c),a.lineTo(-d,0),a.closePath()},square:function(a,b){var c=Math.sqrt(b);a.beginPath(),a.rect(-.5*c,-.5*c,c,c),a.closePath()},"triangle-down":function(a,b){var c=Math.sqrt(b/qb),d=c*qb/2;a.beginPath(),a.moveTo(0,d),a.lineTo(c,-d),a.lineTo(-c,-d),a.closePath()},"triangle-up":function(a,b){var c=Math.sqrt(b/qb),d=c*qb/2;a.beginPath(),a.moveTo(0,-d),a.lineTo(c,d),a.lineTo(-c,d),a.closePath()}});a.canvas.symbolTypes=pb.keys();var qb=Math.sqrt(3),rb=Math.tan(30*fb);a.canvas.transition=function(b,c){var d=a.transition(b,c);return d};var sb=0;Ca.defaults={},Ca.defaults.paper={type:"svg",resizeDelay:200,resize:!0,interact:!0,css:null},Ca.defaults.viz=Ma({onInit:null,contextmenu:[{label:"Open Image",callback:function(a){window.open(a.image())}}]}),Ca.constants={DEFAULT_VIZ_GROUP:"default_viz_group",WIDTH:400,HEIGHT:300,vizevents:["data","change","start","tick","end"],pointEvents:["mouseenter","mousemove","touchstart","touchmove","mouseleave","mouseout"],groupEvents:[],leaflet:"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"},Ca.options=function(a,b){return a&&Ua(a.pluginOptions)?b&&a.pluginOptions(b):(a=Ma({},Ca.defaults.paper,a),a=ka(a,{}).pluginOptions(b||Ca.paper.plugins)),a};var tb={init:function(){},defaults:{},options:function(a,b){var c=this.name,d=this.defaults;a[c]=Ma({},d,a[c]),Qa(b,function(b){a[c][b]=Ma({},a[b],d[b],a[c][b])})},optionsShow:function(a,b){var c=this.name,d=this.defaults,e=a[c];e===!0?e={show:!0}:e?void 0===e.show&&(e.show=!0):e={show:!1},a[c]=Ma({},this.defaults,e),Qa(b,function(b){a[c][b]=Ma({},a[b],d[b],a[c][b])})},extend:function(a,b){Ma(a,b)}};Ca.gradient=function(){function b(b){b.each(function(){if("canvas"===this.tagName.toLowerCase()){var b=this.getContext("2d");"linear"===k?d(b):radial_canvas(b)}else{var e=a.select(this),f=z(e),g="grad-"+f,h=A(e);h.select("#"+g).remove();var i="linear"===k?c(h):radialsvg(h);i.attr("id",g),e.attr("fill","url(#"+g+")")}})}function c(a){var b=a.append("linearGradient").attr("x1","0%").attr("y1","0%");return"x"===j?b.attr("x2","100%").attr("y2","0%"):b.attr("y2","100%").attr("x2","0%"),e.forEach(function(a){b.append("stop").attr("offset",a.offset+"%").attr("stop-color",a.color).attr("stop-opacity",void 0===a.opacity?1:a.opacity)}),b}function d(a){var b;b="x"===j?a.createLinearGradient(f,h,g,h):a.createLinearGradient(f,h,f,i),e.forEach(function(a){b.addColorStop(.01*a.offset,a.color)}),a.fillStyle=b,a.fill()}var e=[{color:"#000",opacity:1,offset:0},{color:"#fff",opacity:1,offset:100}],f=0,g=200,h=0,i=200,j="y",k="linear";return b.direction=function(a){return arguments.length?(j=a,b):j},b.colors=function(a){if(!arguments.length)return e;var c=100/a.length;return e=a.map(function(a,b){return Ta(a)&&(a={color:a}),void 0===a.offset&&(a.offset=Math.round(c*b)),a}),b},b.opacity=function(a){return e.forEach(function(b){b.opacity=a}),b},b.y1=function(a){return arguments.length?(h=a,b):h},b.y2=function(a){return arguments.length?(i=a,b):i},b.x1=function(a){return arguments.length?(f=a,b):f},b.x2=function(a){return arguments.length?(g=a,b):g},b},Ca.paper=function(b,c){var d=a.dispatch.apply(null,Ra(["change","active","activeout"],Ca.constants.pointEvents)),e=ga(a.rebind({},d,"on"),c),f=[],g=!1;c=ia(b,e.options());var h=c.type;return b=c.__paper__,e.event=function(a){return d[a]||y},e.group=function(a){a=c.copy(a);var b=Ca.group[a.type](e,a);return b.element().classed(c.giotto,!0),Ca.paper.pluginArray.forEach(function(a){a.init(b)}),b},e.size=function(){return[c.size[0],c.size[1]]},e.select=function(a){var b,d=e.svg().selectAll("."+c.giotto);return a&&(d=d.filter(a)),(b=d.node())?b.__group__:(d=e.canvas().selectAll("."+c.giotto),a&&(d=d.filter(a)),b=d.node(),b?b.__group__:void 0)},e.each=function(a,b){return 1===arguments.length&&(b=a,a="*"),e.svg().selectAll(a).each(function(){this.__group__&&b.call(this.__group__)}),e.canvas().selectAll(a).each(function(){this.__group__&&b.call(this.__group__)}),e},e.clear=function(){return e.svg().remove(),e.canvas().remove(),e.canvasOverlay().remove(),c.colorIndex=0,e},e.render=function(){var b=e.canvasBackground().node(),d=e.canvasOverlay().node();return b&&a.canvas.clear(b.getContext("2d")),d&&a.canvas.clear(d.getContext("2d")),c.fill&&e.element().style("background",c.fill),e.each(function(){this.render()}),e},e.element=function(){return a.select(b)},e.classGroup=function(a,b){var c=e.select("."+a);return c||(c=e.group(b),c.element().classed(a,!0)),c},e.resize=function(a){return g=!0,a||(a=e.boundingBox()),(c.size[0]!==a[0]||c.size[1]!==a[1])&&(c.size[0]=a[0],c.size[1]=a[1],e.canvasOverlay(),e.canvasBackground(!1,!0),e.each(function(){this.resize()}),d.change.call(e,{type:"change"})),g=!1,e},e.boundingBox=function(){var b,d=c.elwidth?B(c.elwidth):c.size[0];return b=c.height_percentage?a.round(d*c.height_percentage,0):c.elheight?C(c.elheight):c.size[1],c.min_height&&(b=Math.max(b,c.min_height)),[Math.round(d),Math.round(b)]},e.svg=function(a){var b=e.element().select("svg.giotto");return!b.node()&&a&&(b=e.element().append("svg").attr("class","giotto").attr("width",c.size[0]).attr("height",c.size[1])),c.resize||b.attr("viewBox","0 0 "+c.size[0]+" "+c.size[1]),b},e.svgBackground=function(a){var b=e.svg();if(b.size()){var c=b.select(".giotto-background");return!c.size()&&a&&(c=b.insert("g","*").classed("giotto-background",!0)),c}},e.canvas=function(a){var b=e.element().select("div.canvas-container");return!b.node()&&a&&(b=e.element().append("div").attr("class","canvas-container").style("position","relative")),b},e.canvasBackground=function(b,d){var f=e.canvas();if(f.size()){var g=f.select(".giotto-background"),h=g.node();return!h&&b&&(f.selectAll("*").style({position:"absolute",top:"0",left:"0"}),g=f.insert("canvas","*").classed("giotto-background",!0),a.canvas.retinaScale(g.node().getContext("2d"),c.size[0],c.size[1])),h&&d&&a.canvas.resize(h.getContext("2d"),c.size[0],c.size[1]),g}return f},e.canvasOverlay=function(){var b=e.element().select(".canvas-overlay"),d=b.node();return!d&&e.canvas().node()?(b=e.element().append("canvas").attr("class","canvas-overlay").style({position:"absolute",top:"0",left:"0"}),d=b.node(),a.canvas.retinaScale(d.getContext("2d"),c.size[0],c.size[1]),e.registerEvents(b,Ca.constants.pointEvents)):d&&a.canvas.resize(d.getContext("2d"),c.size[0],c.size[1]),b},e.canvasDataAtPoint=function(a){var b=[];return e.canvas().selectAll("*").each(function(){this.__group__&&this.__group__.dataAtPoint(a,b)}),b},e.encodeSVG=function(){var a=e.svg();return a.node()?btoa(unescape(encodeURIComponent(a.attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML))):void 0},e.imageSVG=function(){var a=e.encodeSVG();return a?"data:image/svg+xml;charset=utf-8;base64,"+a:void 0},e.imagePNG=function(){var a=e.canvas();if(a.node()){var b,c=e.group({type:"canvas",margin:{left:0,right:0,top:0,bottom:0}}),d=c.context();a.selectAll("*").each(function(){this.__group__!==c&&(b=new Image,b.src=this.getContext("2d").canvas.toDataURL(),d.drawImage(b,0,0,d.canvas.width,d.canvas.height))});var f=d.canvas.toDataURL();return c.remove(),f}},e.image=function(){return"svg"===c.type?e.imageSVG():e.imagePNG()},e.type=function(){return h},e.registerEvents=function(b,c,d,f){var g,h;return c.forEach(function(c){h=d?c+"."+d:c,b.on(h,function(){d&&!e.element().select("#"+d).size()?b.on(c+"."+d,null):(g=f?f.call(this):this,e.event(a.event.type).call(g))})}),b},e.task=function(a){f.push(a)},c.css&&Ya("#giotto-paper-"+e.uid(),c.css),c.resize&&a.select(window).on("resize.paper"+e.uid(),function(){g||(c.resizeDelay?(g=!0,a.timer(function(){return e.resize(),!0},c.resizeDelay)):e.resize())}),a.timer(function(){if(!e.element().size())return!0;for(var a=0;a<f.length;++a)f[a]()}),da(e),e},ja(Ca.paper),Ca.group=function(b,c,d,e){var f=[],g=1,h=!1,i=!1,j=d.type,k=(a[j],a.scale.linear()),l=a.dispatch.apply(null,Ca.constants.groupEvents),m=ga(a.rebind({},l,"on"),d);return c.__group__=m,d=m.options(),m.type=function(){return j},m.event=function(a){return l[a]||y},m.element=function(){return a.select(c)},m.paper=function(){return b},m.width=function(){return g*d.size[0]},m.height=function(){return g*d.size[1]},m.factor=function(a){return arguments.length?(g=+a,m):g},m.size=function(){return[m.width(),m.height()]},m.add=function(a){return Ua(a)&&(a=la(m,a)),f.push(a),a},m.each=function(a){for(var b=0;b<f.length;++b)a.call(f[b]);return m},m.render=function(){if(!h){h=!0;for(var a=0;a<f.length;++a)f[a].render();return h=!1,m}},m.rendering=function(){return h},m.remove=function(a){if(!arguments.lenght)return m.element().remove();for(var b,c=0;c<f.length;++c)if(b=f[c],a){if(b.name()===a)return b.remove(),f.splice(c,1)}else b.remove();return m},m.resize=function(a){return i=!0,e.resize(m,a),i=!1,m},m.resizing=function(){return i},m.scale=function(a){return arguments.length?k(a):k},m.fromPX=function(a){return k.invert(g*a)},m.xfromPX=m.fromPX,m.yfromPX=m.fromPX,m.dim=function(a){if(!a)return 0;var b=+a;return isNaN(b)?m.fromPX(a.substring(0,a.length-2)):b},m};var ub=["fill","fillOpacity","color","colorOpacity","lineWidth"];Ca.group.svg=function(a,b){var c=a.svg(!0),d=b.before?c.insert("g",b.before):c.append("g"),e={};delete b.before,d.attr("transform","translate("+b.margin.left+","+b.margin.top+")"),e.resize=function(c){b.resize&&(a.svg().attr("width",b.size[0]).attr("height",b.size[1]),c.resetAxis().render())};var f=Ca.group(a,d.node(),b,e);return f.clear=function(){return f.element().selectAll("*").remove(),f},f.draw=function(a){return a.attr("stroke",function(a){return a.color}).attr("stroke-opacity",function(a){return a.colorOpacity}).attr("stroke-width",function(a){return a.lineWidth}).attr("fill",function(a){return a.fill}).attr("fill-opacity",function(a){return"none"===a.fill?void 0:a.fillOpacity})},f.events=function(b,c,d){return a.registerEvents(b,Ca.constants.pointEvents,c,d)},f},Ca.svg.font=function(a,b){return b=Ma({},Ca.defaults.paper.font,b),oa(a,b)},Ca.group.canvas=function(b,c){var d=b.canvas(!0),e=c.before?d.insert("canvas",c.before):d.append("canvas"),f=e.node().getContext("2d"),g={};delete c.before,d.selectAll("*").style({position:"absolute",top:"0",left:"0"}),d.select("*").style({position:"relative"}),g.scale=function(b){return a.canvas.retinaScale(b.context(),c.size[0],c.size[1])},g.resize=function(b){a.canvas.clear(b.context()),g.scale(b),b.resetAxis().render()};var h=Ca.group(b,e.node(),c,g),i=h.render;return h.render=function(){return a.canvas.clear(f),i()},h.clear=function(){return a.canvas.clear(f),h},h.context=function(){return f},h.dataAtPoint=function(a,b){var c,d=a[0],e=a[1];h.each(function(){this.each(function(){c=this.inRange(d,e),c===!0?b.push(this):c&&b.push(c)})})},h.transform=function(a){var b=h.factor();return a.setTransform(1,0,0,1,0,0),a.translate(b*c.margin.left,b*c.margin.top),h},h.factor(g.scale(h))},Ca.canvas.font=function(a,b){b=Ma({},Ca.defaults.paper.font,b),a.fillStyle=b.color,a.font=_a(b)},Ca.viz={},ja(Ca.viz),Ca.createviz=function(b,c,d){var e=function(b,c){Sa(b)&&(c=b,b=null);var f,g=Ra([],Ca.viz.pluginArray,e.pluginArray),h=Ra([],Ca.paper.pluginArray,g),i=ha({},e.defaults,h).options(c),j=a.dispatch.apply(a,Ca.constants.vizevents),k=0;return i.event=function(a){return j[a]},i.vizType=function(){return e},i.vizName=function(){return e.vizName()},i.paper=function(a){return(a||void 0===f)&&(f&&f.clear(),f=i.createPaper()),f},i.createPaper=function(){return Ca.paper(b,i.options())},i.element=function(){return i.paper().element()},i.clear=function(){return i.paper().clear(),i},i.alpha=function(b){return arguments.length?(b=+b,k?k=b>0?b:0:b>0&&(j.start({type:"start",alpha:k=b}),a.timer(i.tick)),i):k},i.resume=function(){return i.alpha(.1)},i.stop=function(){return i.alpha(0)},i.tick=function(){return(k*=.99)<.005?(j.end({type:"end",alpha:k=0}),!0):void j.tick({type:"tick",alpha:k})},i.start=function(){return ra(i).load(i.resume)},i.render=function(){return f.render(),i},i.image=function(){return f.image()},a.rebind(i,j,"on"),d&&d(i),g.forEach(function(a){a.init(i)}),i};return Ca.viz[b]=e,e.defaults=Ma({},Ca.defaults.viz,c),e.vizName=function(){return b},ja(e),e},Ca.createviz("viz"),Ca.paper.plugin("font",{defaults:{color:"#444",size:"11px",weight:"normal",lineHeight:13,style:"normal",family:"sans-serif",variant:"small-caps"}}),Ca.paper.plugin("margin",{defaults:{top:20,right:20,bottom:20,left:20},init:function(a){var b=a.options(),c=a.factor();a.innerWidth=function(){return c*(b.size[0]-b.margin.left-b.margin.right)},a.innerHeight=function(){return c*(b.size[1]-b.margin.top-b.margin.bottom)},a.aspectRatio=function(){return a.innerHeight()/a.innerWidth()},a.marginLeft=function(){return c*b.margin.left},a.marginRight=function(){return c*b.margin.right},a.marginTop=function(){return c*b.margin.top},a.marginBottom=function(){return c*b.margin.bottom}},options:function(a){var b=a.margin;void 0===b||Sa(b)?a.margin=Ma({},this.defaults,b):a.margin={left:b,right:b,top:b,bottom:b}}});Ca.paper.plugin("tooltip",{defaults:{className:"d3-tip",fill:"#deebf7",fillOpacity:.8,color:"#222",padding:"8px",radius:"3px",offset:[20,20],template:function(a){return"<p><span style='color:"+a.c+"'>"+a.l+"</span>  <strong>"+a.x+": </strong><span>"+a.y+"</span></p>"},font:{size:"14px"}},options:function(a){this.optionsShow(a,["font"])},init:function(a){var b=a.paper();b.showTooltip||sa(b)}}),Ca.tip=function(){function b(){return"n"}function c(){return" "}function d(){return{top:n.n.y-r.offsetHeight-p[1],left:n.n.x-r.offsetWidth/2}}function e(){return{top:n.s.y+p[1],left:n.s.x-r.offsetWidth/2}}function f(){return{top:n.e.y-r.offsetHeight/2,left:n.e.x+p[0]}}function g(){return{top:n.w.y-r.offsetHeight/2,left:n.w.x-r.offsetWidth-p[0]}}function h(){return{top:n.nw.y-r.offsetHeight-p[1],left:n.nw.x-r.offsetWidth-p[0]}}function i(){return{top:n.ne.y-r.offsetHeight-p[1],left:n.ne.x+p[0]}}function j(){return{top:n.sw.y+p[1],left:n.sw.x-r.offsetWidth-p[0]}}function k(){return{top:n.se.y+p[1],left:n.e.x+p[0]}}function l(){return{top:n.c.y+p[1],left:n.c.x+p[0]}}function m(){var b=a.select(document.createElement("div"));return b.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),b.node()}var n,o=b,p=[0,0],q=c,r=m(),s={};document.body.appendChild(r),s.show=function(){var b,c=q.call(s),d=o.call(s),e=a.select(r),f=u.length,g=document.documentElement.scrollTop||document.body.scrollTop,h=document.documentElement.scrollLeft||document.body.scrollLeft;for(e.html(c).style({opacity:1,"pointer-events":"all"});f--;)e.classed(u[f],!1);return b=t.get(d).apply(this),e.classed(d,!0).style({top:b.top+g+"px",left:b.left+h+"px"}),s},s.hide=function(){return a.select(r).style({opacity:0,"pointer-events":"none"}),s},s.attr=function(b,c){if(arguments.length<2&&"string"==typeof b)return a.select(r).attr(b);var d=Array.prototype.slice.call(arguments);return a.selection.prototype.attr.apply(a.select(r),d),s},s.style=function(b,c){if(arguments.length<2&&"string"==typeof b)return a.select(r).style(b);var d=Array.prototype.slice.call(arguments);return a.selection.prototype.style.apply(a.select(r),d),s},s.bbox=function(a){return arguments.length?(n=a,s):n},s.direction=function(b){return arguments.length?(o=null===b?b:a.functor(b),s):o},s.offset=function(a){return arguments.length?(p=a,s):p},s.html=function(b){return arguments.length?(q=null===b?b:a.functor(b),s):q};var t=a.map({n:d,s:e,e:f,w:g,nw:h,ne:i,sw:j,se:k,c:l}),u=t.keys();return s};var vb={"d3-tip:after":{}};Ca.createviz("chart",{margin:30,chartTypes:["map","pie","bar","line","point","custom"],xaxis:!0,yaxis:!0,serie:{x:function(a){return a[0]},y:function(a){return a[1]}}},function(a){function b(b){b.forEach||(b=[b]),b.forEach(function(b){Ua(b)&&(b=b(a)),d.push(ua(a,b))})}var c,d=[],e={};a.numSeries=function(){return d.length},a.allranges=function(){return e},a.each=function(b){return d.forEach(b),a},a.forEach=a.each,a.addSeries=function(c){return b(c),a},a.addSerie=function(c){return b([c]),a},a.clear=function(){return a.paper().clear(),d=[],a},a.drawing=function(){return c},a.render=function(){var b=a.options(),d=a.paper();return c=!0,b.type!==d.type()&&(d=a.paper(!0),a.each(function(a){a.clear()})),a.each(function(a){a.draw()}),c=!1,d.render(),a},a.setSerieOption=function(b,c,d){var e=a.options();if(-1!==e.chartTypes.indexOf(b))if(a.numSeries()){var f;a.each(function(a){f=a[b],f&&(Ua(f.set)?f.set(c,d):f[c]=d)})}else e[b][c]=d},a.axisGroup=function(b){return b&&b.axisgroup?a.paper().select("."+a.axisGroupId(b.axisgroup)):void 0},a.on("tick.main",function(){a.stop(),a.render()}),a.axisGroupId=function(b){return"axisgroup"+a.uid()+"-"+b},a.on("data.build_series",function(){var c=a.data();d=[],b(c)})}),Ca.chart=Ca.viz.chart;var wb={map:function(a,b,c){return a.map(b,c)},pie:function(a,b,c){return a.pie(b,c)},bar:va(function(a,b,c){return a.barchart(b,c)}),line:va(function(a,b,c){return a.path(b,c)}),point:va(function(a,b,c){return a.points(b,c)}),custom:function(a,b,c){var d=la(a,function(){return c.show.call(this)}).options(c).data(b);return"canvas"===a.type()&&(d=pa(d),d.each=function(a){return a.call(d),d}),a.add(d)}},xb=function(a,b,c){if(a){a.data||(a={data:a});var d,e=a.data,f=1/0,g=1/0,h=-(1/0),i=-(1/0),j=!1,k=!1,l=function(a){return d=+a,isNaN(d)?(j=!0,a):(f=f>d?d:f,h=d>h?d:h,d)},m=function(a){return d=+a,isNaN(d)?(k=!0,a):(g=g>d?d:g,i=d>i?d:i,d)},n=[];return e.forEach(function(a){n.push({x:l(b(a)),y:m(c(a))})}),a.data=n,a.xrange=[f,h],a.yrange=[g,i],a.xordinal=j,a.yordinal=k,a}};Ca.collection=function(){function b(){var a=c.options();c.forEach(function(b,d){var e=a[b];e&&d.options(e),d.data(c.data()).start()})}var c=ha(a.map());return c.start=function(){return ra(c).load(b)},c},Ca.createviz("map",{tile:null,center:[41.898582,12.476801],zoom:4,maxZoom:18,zoomControl:!0,wheelZoom:!0},function(a){a.start=function(){},a.innerMap=function(){},a.addLayer=function(a,b){},opts.tile&&Ca.viz.map.tileProviders[opts.tile](a,opts)}).tileProviders={},Ca.viz.map.tileProviders.leaflet=function(b,c){function d(a,b){var c=e.latLngToLayerPoint(new L.LatLng(b,a));this.stream.point(c.x,c.y)}var e,f=[];b.start=function(){"undefined"==typeof L?(Ca._.loadCss(Ca.constants.leaflet),Ca.require(["leaflet"],function(){b.start()})):(e=new L.map(b.element().node(),{center:c.center,zoom:c.zoom}),c.zoomControl?c.wheelZoom||e.scrollWheelZoom.disable():(e.dragging.disable(),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.tap&&e.tap.disable()),e.on("viewreset",function(){for(var a=0;a<f.length;++a)f[a]()}),b.resume())},b.innerMap=function(){return e},b.addLayer=function(a,b){e&&L.tileLayer(a,b).addTo(e)},b.addOverlay=function(b,c){var g=a.geo.transform({point:d}),h=a.geo.path().projection(g),i=e?a.select(e.getPanes().overlayPane).append("svg"):null,j=i?i.append("g").attr("class","leaflet-zoom-hide"):null,k=function(){var a=h.bounds(b),d=a[0],e=a[1];i.attr("width",e[0]-d[0]).attr("height",e[1]-d[1]).style("left",d[0]+"px").style("top",d[1]+"px"),j.attr("transform","translate("+-d[0]+","+-d[1]+")"),c&&c(h)};return f.push(k),{element:j,collection:b,path:h,draw:k}}},Ca.slider=function(){function b(b){b.each(function(){function b(){"boolean"==typeof o&&(o=a.svg.axis().ticks(Math.round(i/100)).tickFormat(v).orient("horizontal"===n?"bottom":"right"),B.classed("d3-slider-axis",!0)),g=f.copy().range([0,i]),o.scale(g);var b=B.append("svg").classed("d3-slider-axis d3-slider-axis-"+o.orient(),!0).on("click",z);return b.append("g"),b}function l(){var a=G.select("g");"horizontal"===n?(G.style("margin-left",-p+"px"),G.attr({width:i+2*p,height:p}),"top"===o.orient()?(G.style("top",-p+"px"),a.attr("transform","translate("+p+","+p+")")):a.attr("transform","translate("+p+",0)")):(G.style("top",-p+"px"),G.attr({width:p,height:i+2*p}),"left"===o.orient()?(G.style("left",-p+"px"),a.attr("transform","translate("+p+","+p+")")):a.attr("transform","translate(0,"+p+")")),a.call(o)}function m(){if(!e.length){var b=Math.max(0,Math.min(i,a.event.offsetX||a.event.layerX));c(d(f.invert(b/i)))}}function r(){if(!e.length){var b=i-Math.max(0,Math.min(i,a.event.offsetY||a.event.layerY));c(d(f.invert(b/i)))}}function x(){"handle-one"===a.event.sourceEvent.target.id?q=1:"handle-two"==a.event.sourceEvent.target.id&&(q=2);var b=Math.max(0,Math.min(i,a.event.x));c(d(f.invert(b/i)))}function y(){"handle-one"===a.event.sourceEvent.target.id?q=1:"handle-two"==a.event.sourceEvent.target.id&&(q=2);var b=i-Math.max(0,Math.min(i,a.event.y));c(d(f.invert(b/i)))}function z(){a.event.stopPropagation()}var A=++sb;f||(f=a.scale.linear().domain([j,k])),e=e||f.domain()[0];var B=a.select(this).classed("d3-slider d3-slider-"+n+" d3-slider-"+s,!0),C=a.behavior.drag();C.on("dragend",function(){t.slideend(a.event,e)});var D;if(2==e.length?(h=B.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",z).call(C),w=B.append("a").classed("d3-slider-handle",!0).attr("id","handle-two").attr("xlink:href","#").on("click",z).call(C)):h=B.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",z).call(C),"horizontal"===n){if(B.on("click",m),2==e.length){D=a.select(this).append("div").classed("d3-slider-range",!0),h.style("left",u(f(e[0]))),D.style("left",u(f(e[0]))),C.on("drag",x);var E=100-parseFloat(u(f(e[1])));w.style("left",u(f(e[1]))),D.style("right",E+"%"),C.on("drag",x)}else h.style("left",u(f(e))),C.on("drag",x);i=parseInt(B.style("width"),10)}else{if(B.on("click",r),C.on("drag",y),2==e.length){D=a.select(this).append("div").classed("d3-slider-range-vertical",!0),h.style("bottom",u(f(e[0]))),D.style("bottom",u(f(e[0]))),C.on("drag",y);var F=100-parseFloat(u(f(e[1])));w.style("bottom",u(f(e[1]))),D.style("top",F+"%"),C.on("drag",y)}else h.style("bottom",u(f(e))),C.on("drag",y);i=parseInt(B.style("height"),10)}if(o){var G=b();l(G),a.select(window).on("resize.slider"+A,function(){l()})}})}function c(b){var c=e.length?e[q-1]:e,g=u(f(d(c))),i=u(f(d(b))),j="horizontal"===n?"left":"bottom";if(g!==i){if(2===e.length?(e[q-1]=b,a.event&&t.slide(a.event,e)):a.event&&t.slide(a.event.sourceEvent||a.event,e=b),e[0]>=e[1])return;if(1===q)2===e.length&&("left"===j?divRange.style("left",i):divRange.style("bottom",i)),m?h.transition().styleTween(j,function(){return a.interpolate(g,i)}).duration("number"==typeof m?m:250):h.style(j,i);else{var k=100-parseFloat(i),l=100-parseFloat(i);"left"===j?divRange.style("right",k+"%"):divRange.style("top",l+"%"),m?w.transition().styleTween(j,function(){return a.interpolate(g,i)}).duration("number"==typeof m?m:250):w.style(j,i)}}}function d(a){if(a===f.domain()[0]||a===f.domain()[1])return a;var b=a;if(r){var c=f(a),d=f.ticks().map(function(a){return c-f(a)}),e=-1,g=0,h=f.range()[1];do e++,Math.abs(d[e])<h&&(h=Math.abs(d[e]),g=e);while(d[e]>0&&e<d.length-1);b=f.ticks()[g]}else{var i=(a-f.domain()[0])%l;b=a-i,2*Math.abs(i)>=l&&(b+=i>0?l:-l)}return b}var e,f,g,h,i,j=0,k=100,l=.01,m=!0,n="horizontal",o=!1,p=50,q=1,r=!1,s="default",t=a.dispatch("slide","slideend"),u=a.format(".2%"),v=a.format(".0"),w=null;return b.min=function(a){return arguments.length?(j=a,b):j},b.max=function(a){return arguments.length?(k=a,b):k},b.step=function(a){return arguments.length?(l=a,b):l},b.animate=function(a){
return arguments.length?(m=a,b):m},b.orientation=function(a){return arguments.length?(n=a,b):n},b.axis=function(a){return arguments.length?(o=a,b):o},b.value=function(a){return arguments.length?(e&&c(d(a)),e=a,b):e},b.snap=function(a){return arguments.length?(r=a,b):r},b.scale=function(a){return arguments.length?(f=a,b):f},a.rebind(b,t,"on"),b},Ca.viz.slider=function(b){var c=ha(Ca.slider()),d=c.options;return c.options=function(a){return arguments.length?(Qa(a,function(a,b){Ua(c[b])&&c[b](a)}),d(a)):d()},c.start=function(){c(a.select(b));var e=d(),f=e.onInit;f&&f(c,e)},c},Ca.viz.slider.vizName=function(){return"slider"},Ca.createviz("sunburst",{labels:!0,addorder:!1,transition:{duration:750},scale:"sqrt",initNode:null},function(b){function c(c,g){var i=.5*l.innerWidth(),k=.5*l.innerHeight(),x=l.marginLeft()+i,y=l.marginTop()+k,z=b.options(),A=l.element().attr("transform","translate("+x+","+y+")");j=c[0],n=Math.min(i,k),m=e(),t=a.scale.linear().range([0,2*Math.PI]),u=d(n),v=a[l.type()].arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,t(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,t(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,u(a.y))}).outerRadius(function(a){return Math.max(0,u(a.y+a.dy))}),A.selectAll("*").remove(),s=A.selectAll("path").data(c).enter().append("path").attr("d",v).style("fill",function(a){var b=(a.children?a:a.parent).name;return w[b]||(w[b]=l.pickColor()),w[b]}),z.labels&&(r=[],o=A.append("g").attr("class","text").selectAll("g").data(s.data()).enter().append("g"),p=o.append("path").attr("d",v).attr("opacity",0).on("click",function(a){f(a)}),q=o.append("text").text(function(a){return void 0!==z.addorder&&void 0!==a.order?a.order+" - "+a.name:a.name}),h(q)),b.select(g,0)||b.event("change").call(b,{type:"change"})}function d(c){var d=b.options();return"linear"===d.scale?a.scale.linear().range([0,c]):a.scale.sqrt().range([0,c])}function e(){var a=Math.min(l.innerWidth(),l.innerHeight());return 400>a?Math.round(100-.15*(500-a)):100}function f(c,d){function e(a){return a.x>=c.x&&a.x<c.x+c.dx}if(c&&c!==j){var f=b.options();void 0===d&&(d=+f.transition.duration),q&&q.transition().attr("opacity",0);var g=i(c);return s.transition().duration(d).attrTween("d",g).each("end",function(a,d){c===a&&(j=a,b.event("change").call(b,{type:"change"}))}),q&&(r=[],p.transition().duration(d).attrTween("d",g).each("end",function(b,c){b.depth>=j.depth&&e(b)&&h(a.select(this.parentNode).select("text").transition().duration(d).attr("opacity",1))})),!0}}function g(a){function b(a){var b=c-a;b>=0&&e>b?(c+=e,d=!0):0>b&&b>-e&&(c-=e-b,d=!0)}for(var c=t(a.x+a.dx/2),d=!0,e=Math.PI/40;d;)d=!1,r.forEach(b);return r.push(c),c}function h(a){var b,c=j.depth;return a.attr("x",function(a,d){return a.depth===c?0:(b=g(a,t,u),this.__data__.angle=b,b>Math.PI?-u(a.y):u(a.y))}).attr("dx",function(a){return a.depth===c?0:a.angle>Math.PI?-6:6}).attr("dy",function(a){return a.depth===c?a.depth?40:0:".35em"}).attr("transform",function(a){return b=0,a.depth>c&&(b=a.angle,b>Math.PI&&(b-=Math.PI),b-=Math.PI/2),"rotate("+b/Math.PI*180+")"}).attr("text-anchor",function(a){return b=a.angle,a.depth===c?"middle":b&&b>Math.PI?"end":"start"}).style("font-size",function(a){var b=a.depth-c,d=m;return b?b>0&&(d=Math.max(1.2*d-20*b,30)):d*=1.2,Math.round(d)+"%"})}function i(b){var c=a.interpolate(t.domain(),[b.x,b.x+b.dx]),d=a.interpolate(u.domain(),[b.y,1]),e=a.interpolate(u.range(),[b.y?20:0,n]);return function(a,b){return b?function(b){return v(a)}:function(b){return t.domain(c(b)),u.domain(d(b)).range(e(b)),v(a)}}}var j,k,l,m,n,o,p,q,r,s,t,u,v,w={};b.on("tick.main",function(a){b.stop(),b.draw()}),b.select=function(a,c){if(j){if(Va(a)){var d=a;a=b.root();for(var e=0;e<d.length;++e){var g=d[e];if(!a.children)break;for(var h=0;h<=a.children.length;++h)if(a.children[h]&&a.children[h].name===g){a=a.children[h];break}}}return f(a,c)}},b.current=function(){return j},b.root=function(){for(var a=j;a&&a.parent;)a=a.parent;return a},b.scale=function(a){var c=b.options();return arguments.length?(c.scale=a,b):c.scale},b.draw=function(){var d=b.data(),e=b.options();k&&e.type===l.type()||(k=b.paper(!0),l=k.group(),l.element().classed("sunburst",!0)),d&&(d=a.layout.partition().value(function(a){return a.size}).sort(function(a){return void 0===a.order?a.size:a.order}).nodes(d),j=(Ua(e.initNode)?e.initNode():e.initNode)||d[0],l.add(function(){c(d,j)})),b.render()}}),Ca.createviz("trianglify",{fillOpacity:1,strokeOpacity:1,variance:.75,seed:null,cell_size:80,color:null,x_color:null,y_color:null},function(a){function b(){{var d=a.options(),e=+d.cell_size,f=a.gradient(d.color),g=a.gradient(d.x_gradient)||f,h=a.gradient(d.y_gradient)||f,i=a.paper(),j=i.element();i.size()}c||(i.on("change.trianglify"+i.uid(),b),i.image=function(){var a=l.dataUrl;return a.substring(4,a.length-1)});var k=c.opts;g&&(k.x_color=g),y_gradient&&(k.y_color=h),e>0&&(k.cell_size=e);var l=a.Trianglify(k),m=j.select(".trianglify-background");if(!m.node()){for(var n=j.node(),o=document.createElement("div"),p=n.childNodes;p.length;)o.appendChild(p[0]);o.className="trianglify-background",n.appendChild(o),m=j.select(".trianglify-background")}m.style("min-height","100%").style("background-image",l.dataUrl)}var c;a.gradient=function(a){if(a&&"string"==typeof a){var b=a.split("-");if(2===b.length){var c=Trianglify.colorbrewer[b[0]],d=+b[1];if(c)return c[d]}}},a.on("tick.main",function(c){a.stop(),void 0===a.Trianglify&&"undefined"==typeof Trianglify?require(["trianglify"],function(b){a.Trianglify=b||null,a.resume()}):(void 0===a.Trianglify&&(a.Trianglify=Trianglify),b())})}),Ca.paper.plugin("axis",{defaults:{tickSize:"6px",outerTickSize:"6px",tickPadding:"3px",lineWidth:1,textRotate:0,textAnchor:null,color:"#444",colorOpacity:1,min:null,max:null},init:function(b){var c=b.type(),d=a[c],e=d.axis(),f=d.axis();e.options=function(){return b.options().xaxis},f.options=function(){return b.options().yaxis},b.xaxis=function(){return e},b.yaxis=function(){return f},b.drawXaxis=function(){return b.add(Ca[c].axis(b,e,"x-axis")).options(e.options())},b.drawYaxis=function(){return b.add(Ca[c].axis(b,f,"y-axis")).options(f.options())},b.scalex=function(a){return e.scale()(a)},b.scaley=function(a){return f.scale()(a)},b.x=function(a){var b=e.scale().domain();return a*(b[b.length-1]-b[0])+b[0]},b.y=function(a){var b=f.scale().domain();return a*(b[b.length-1]-b[0])+b[0]},b.ordinalScale=function(b,c){var d=b.scale(),e=b.options();return e.auto=!1,e.scale="ordinal",d.rangeBand?c=c||d.rangeExtent():(c=c||d.range(),d=b.scale(a.scale.ordinal()).scale()),d.rangeRoundBands(c,.2)},b.resetAxis=function(){var c=[[0,b.innerWidth()],[b.innerHeight(),0]];return b.scale().range(c[0]),[e,f].forEach(function(d,e){var f=d.options(),g=d.scale();"ordinal"===f.scale?g=b.ordinalScale(d,c[e]):(f.auto=Wa(f.min)||Wa(f.max),"time"===f.scale&&(g=d.scale(a.time.scale()).scale()),g.range(c[e]));var h=b.scale(b.dim(f.tickSize)),i=b.scale(b.dim(f.outerTickSize)),j=b.scale(b.dim(f.tickPadding));if(d.tickSize(h,i).tickPadding(j).orient(f.position),f.tickFormat){var k=f.tickFormat;Ta(k)&&(k="time"===f.scale?a.time.format(k):a.format(k)),d.tickFormat(k)}}),b},b.resetAxis()},options:function(a){function b(a){this.optionsShow(a,["font"])}var c=ja({});c.plugin("xaxis",{defaults:Ma({position:"bottom"},this.defaults,a.axis),options:b}),c.plugin("yaxis",{defaults:Ma({position:"left"},this.defaults,a.axis),options:b}),c.plugin("yaxis2",{defaults:Ma({position:"right"},this.defaults,a.axis),options:b}),a.pluginOptions(c.pluginArray)}}),Ca.svg.axis=function(a,b,c){return la(a,function(){var d=0,e=0,f=a.element().select("."+c),g=this.options(),h=g.font;if(g.show===!1)return void f.remove();if(f.node()||(f=this.group().element().append("g").attr("class",c)),"x"===c[0]?e="top"===g.position?0:this.group().innerHeight():d="left"===g.position?0:this.group().innerWidth(),f.attr("transform","translate("+d+","+e+")").call(b),f.selectAll("line, path").attr("stroke",this.color).attr("stroke-opacity",this.colorOpacity).attr("stroke-width",this.lineWidth).attr("fill","none"),h){var i=f.selectAll("text");g.textRotate&&i.attr("transform","rotate("+g.textRotate+")"),g.textAnchor&&i.style("text-anchor",g.textAnchor),g.dx&&i.attr("dx",g.dx),g.dy&&i.attr("dy",g.dy),oa(i,h)}else f.selectAll("text").remove();return f})},Ca.canvas.axis=function(b,c,d){var e=pa(la(b));return e.render=function(){var f=0,g=0,h=e.context(),i=e.options(),j=i.font;if(!i.show)return e;if(h.save(),b.transform(h),j){var k=j.size;j.size=b.scale(b.dim(k))+"px",h.font=_a(j),j.size=k}return h.strokeStyle=a.canvas.rgba(e.color,e.colorOpacity),h.fillStyle=e.color,h.lineWidth=b.factor()*e.lineWidth,"x"===d[0]?g="top"===i.position?0:b.innerHeight():f="left"===i.position?0:b.innerWidth(),h.translate(f,g),c.textRotate(fb*(i.textRotate||0)).textAlign(i.textAnchor),c(a.select(h.canvas)),h.stroke(),h.restore(),e},e},Ca.paper.plugin("bar",{defaults:{width:"auto",color:null,fill:!0,fillOpacity:1,colorOpacity:1,lineWidth:1,radius:4,active:{fill:"darker",color:"brighter"}},init:function(a){var b=a.type();a.barchart=function(c,d){return d||(d={}),ea(a,d),a.drawColor(Na(a.options().bar,d)),a.add(Ca[b].barchart).pointOptions(Ra(["size"],ub)).size(zb).options(d).dataConstructor(yb).data(c)}},options:function(a){this.optionsShow(a,["active","tooltip"])}});var yb=function(b){var c=this.group(),d=this,e=this.options(),f=[],g=e.width,h=Ca[c.type()].bar;"auto"===g&&(g=function(){return a.round(.8*(c.innerWidth()/d.data().length))});for(var i=0;i<b.length;i++)f.push(h(this,b[i],g));return f},zb=function(a){var b=a.size;return"function"==typeof b&&(b=b()),b};Ca.svg.bar=function(a,b,c){var d=na(a,b),e=a.group();return d.set("size",void 0===b.size?c:b.size),d.render=function(a){e.draw(a)},d},Ca.svg.barchart=function(){var a,b=this.group(),c=b.element().select("#"+this.uid()),d=this.options(),e=b.xaxis().scale(),f=this.scalex(),g=this.scaley(),h=this.size(),i=b.scaley(0),j=this.data(),k=d.transition;return c.node()||(c=b.element().append("g").attr("id",this.uid())),a=c.selectAll(".bar").data(j),a.enter().append("rect").attr("class","bar"),a.exit().remove(),b.events(b.draw(a)),!b.resizing()&&k&&k.duration&&(a=a.transition().duration(k.duration).ease(k.ease)),a.attr("y",function(a){return Math.min(i,g(a.data))}).attr("height",function(a){return gb(g(a.data)-i)}),e.rangeBand?a.attr("x",function(a){return f(a.data)}).attr("width",e.rangeBand()):a.attr("x",function(a){return f(a.data)-.5*h(a)}).attr("width",h),d.radius>0&&a.attr("rx",d.radius).attr("ry",d.radius),c},Ca.canvas.barchart=function(){this.each(function(){this.reset().render()})},Ca.canvas.bar=function(b,c,d){function e(c){var d=l.context();d.save(),m.transform(d),k=r*b.options().radius,d.beginPath(),f=o(l.data),j=0,n.invert?j=i=.5*q(l):i=n.rangeBand(),g=p(l.data),h=m.scaley(0),a.canvas.drawPolygon(d,[[f-j,h],[f+i,h],[f+i,g],[f-j,g]],k),d.closePath();var e=c(d);return d.restore(),e}var f,g,h,i,j,k,l=pa(na(b,c)),m=l.group(),n=m.xaxis().scale(),o=b.scalex(),p=b.scaley(),q=b.size(),r=b.factor();return l.set("size",void 0===c.size?d:c.size),l.render=function(){return e(function(b){return a.canvas.style(b,l),l})},l.inRange=function(a,b){return e(function(c){return c.isPointInPath(a,b)})},l.bbox=function(){var a,b=o(l.data)+m.marginLeft(),c=p(l.data)+m.marginTop(),d=m.scaley(0)+m.marginTop(),e=Math.min(c,d),f=c+d-e,g=0;return n.rangeBand?a=n.rangeBand():g=a=.5*q(l),qa(l,[b-g,e],[b+a,e],[b+a,f],[b-g,f])},l},Ca.paper.plugin("brush",{defaults:{axis:"x",fill:"#000",fillOpacity:.125},init:function(b){function c(a,b){var c,e=a.x(),f=[],g=d.extent();if(b){var h=a.group();b.save(),b.translate(h.marginLeft(),h.marginTop())}return a.each(function(){this.data&&(c=e(this.data),g[0]<=c&&c<=g[1]?(this.highLight(),b&&this.render(b),f.push(this)):this.reset())}),b?b.restore():a.render(),f}var d,e;b.brush=function(){return d},b.addBrush=function(f){return e?e:(e=b.add(function(){function e(){b.element().classed("selecting",!0),i.start&&i.start()}function f(){i.move&&i.move()}function g(){b.element().classed("selecting",!1),i.end&&i.end()}var h=this,i=h.options(),j=b.type(),k=b.resizing();if(d||(k=!0,d=a[j].brush().on("brushstart",e).on("brush",f).on("brushend",g),("x"===i.axis||"xy"===i.axis)&&d.x(b.xaxis().scale()),("y"===i.axis||"xy"===i.axis)&&d.y(b.yaxis().scale()),i.extent&&d.extent(i.extent),"svg"===j?d.selectDraw=c:d.selectDraw=function(a){c(a,b.paper().canvasOverlay().node().getContext("2d"))}),k)if(d.extent(d.extent()),"svg"===j){var l=b.element().select(".brush");l.node()||(l=b.element().append("g").classed("brush",!0));var m=l.call(d).selectAll("rect");this.setBackground(m),"x"===i.axis&&m.attr("y",-6).attr("height",b.innerHeight()+7),e(),f(),g()}else d.fillStyle(a.canvas.rgba(this.fill,this.fillOpacity)).rect([b.marginLeft(),b.marginTop(),b.innerWidth(),b.innerHeight()]),b.paper().canvasOverlay().call(d)}),e.options(Ma({},b.options().brush,f)))}}}),Ca.viz.chart.plugin("brushchart",{init:function(a){var b,c;a.addBrush=function(){b=a.options().brush;var d=b.start,e=b.move,f=b.end;return b.start=function(){d&&d(a)},b.move=function(){a.each(function(b){var c=a.axisGroup(b),d=c?c.brush():null;d&&(b.point&&d.selectDraw(b.point),b.bar&&d.selectDraw(b.bar))}),e&&e(a)},b.end=function(){f&&f(a)},a.paper().each(".reference",function(){this.addBrush(c).render()}),a},a.on("tick.brush",function(){a.options().brush.show&&a.addBrush()})}}),Ca.paper.plugin("bubble",{defaults:{force:!1,theta:.8,friction:.9},init:function(a){a.bubble=function(b,c){return c||(c={}),ea(a,c),c=Na(a.options().bubble,c),a.add(Ca[type].bubble).dataConstructor(Ab).options(c)}}});var Ab=function(a){return a};Ca.svg.bubble=function(){var b=this.group(),c=this.options(),d=(a.layout.pack().padding(c.padding).size([b.innerWidth(),b.innerHeight()]).sort(null).data(this.data()),b.element().selectAll("#"+this.uid()).data([!0]));d.enter().append("g").attr("id",thiss.uid())};var Bb=[!0,"none","color"],Cb={defaults:{scale:a.scale.category10().range(),darkerColor:0,brighterColor:0,colorIndex:0},init:function(b){var c=b.options().colors;b.pickColor=function(b){0===arguments.length&&(b=c.colorIndex++);for(var d=0,e=0;b>=c.scale.length;)b-=c.scale.length,d+=c.darkerColor,e+=c.brighterColor;var f=c.scale[b];return d?f=a.rgb(f).darker(d).toString():e&&(f=a.rgb(f).brighter(e).toString()),f},b.drawColor=function(c){return c.color||(c.fill&&-1===Bb.indexOf(c.fill)?c.color=a.rgb(c.fill).darker().toString():c.color=b.pickColor()),c.fill===!0?c.fill=a.rgb(c.color).brighter().toString():"color"===c.fill&&(c.fill=c.color),c.color}},options:function(b){var c=Ma({},this.defaults,b.colors);Ua(c.scale)&&(c.scale=c.scale(a)),b.colors=c}};Ca.paper.plugin("colors",Cb),Ca.viz.plugin("colors",Cb),Ca.paper.plugin("fill",{init:function(b){function c(){{var a=b.element().selectAll("rect").data([!0]);this.fill}a.enter().append("rect").attr("x",0).attr("y",0),a.attr("width",b.innerWidth()).attr("height",b.innerWidth()),b.setBackground(this,a)}function d(){var a=b.context(),c=b.innerWidth(),d=b.innerHeight();a.beginPath(),a.rect(0,0,c,d),Ua(this.fill)&&this.fill.x1(0).y1(0).x2(c).y2(d),b.setBackground(this)}var e=b.type();b.fill=function(a){return Sa(a)||(a={fill:a}),b.add("svg"===e?c:d).options(a)},"svg"===e?b.setBackground=function(a,c){return c?(Sa(a)&&(void 0!==a.fillOpacity&&c.attr("fill-opacity",a.fillOpacity),a=a.fill),Ta(a)?c.attr("fill",a):Ua(a)&&a(c),b):void 0}:b.setBackground=function(c,d){var e=c;return d=d||b.context(),Sa(e)&&(e=e.fill),Ua(e)?e(b.element()):Sa(c)?d.fillStyle=a.canvas.rgba(c.fill,c.fillOpacity):Ta(c)&&(d.fillStyle=c),b}}}),Ca.paper.plugin("grid",{"default":{color:"#333",colorOpacity:.3,fill:"none",fillOpacity:.2,lineWidth:.5,xaxis:!0,yaxis:!0},init:function(a){function b(){{var b=d.innerWidth(),c=d.innerHeight(),e=d.type();this.group().options()}if("svg"===e){var f=d.element().select(".grid-rectangle");f.node()||(f=d.element().append("rect").attr("class","grid-rectangle")),f.attr("width",b).attr("height",c),this.setBackground(f)}else{var g=d.context();g.save(),a.transform(g),g.beginPath(),g.rect(0,0,b,c),"none"!=this.fill&&(this.setBackground(g),g.fill()),g.restore()}d.xaxis().tickSize(-c,0),d.yaxis().tickSize(-b,0)}function c(){if(scalex){var a=scalex.invert(opts.margin.left),b=scalex.invert(opts.size[0]-opts.margin.right);d.xaxis().scale().domain([a,b])}if(scaley){var c=scalex.invert(opts.margin.top),e=scalex.invert(opts.size[1]-opts.margin.bottom);d.yaxis().scale().domain([c,e])}}var d,e,f=a.paper();a.grid=function(){return d},a.showGrid=function(){return d?d.clear().render():(e||(e=Ma({},a.options()),e.xaxis=Ma({position:"top",size:0,show:e.grid.xaxis},e.grid),e.yaxis=Ma({position:"left",size:0,show:e.grid.yaxis},e.grid)),e.before="*",d=f.group(e),d.element().classed("grid",!0),d.xaxis().tickFormat(wa).scale(a.xaxis().scale()),d.yaxis().tickFormat(wa).scale(a.yaxis().scale()),d.add(b).options(e.grid),e.xaxis.show&&d.drawXaxis(),e.yaxis.show&&d.drawYaxis(),d.on("zoom",c),d.render()),a},a.hideGrid=function(){return d&&d.remove(),a}}}),Ca.viz.chart.plugin("gridchart",{},function(a){a.showGrid=function(){return a.paper().each(".reference",function(){this.showGrid()}),a},a.hideGrid=function(){return a.paper().each(".reference",function(){this.hideGrid()}),a},a.on("tick.grid",function(){var b=a.options().grid;b.show?a.showGrid():a.hideGrid()})});var Db=["bottom","top"];Ca.viz.chart.plugin("legend",{defaults:{show:!1,draggable:!1,margin:50,position:"top-right",padding:5,textPadding:5,fill:"#fff",fillOpacity:1,color:"#000",colorOpacity:1,lineWidth:1,radius:0,symbolLength:30,symbolPadding:10,font:{size:"14px"}},options:function(a){a.legend=Ma({},this.defaults,a.legend),a.legend.font=Ma({},a.font,a.legend.font)},init:function(b){function c(){function a(a,b){b||(b={}),b.label||(b.label=a.label),b.line=a.line,b.point=a.point,b.bar=a.bar,b.pie=a.pie,b.index=c.length,c.push(b)}var c=[];return b.each(function(b){Va(b.legend)?b.legend.forEach(function(c){a(b,c)}):a(b,b.legend)}),c}function d(a,b,c){var d,e,f=g.legend.position;return"bottom"===f.substring(0,6)?(f=f.substring(7),e=a.height()-1.7*c):"top"===f.substring(0,3)?(f=f.substring(4),e=0):e=0,d="left"==f?0:"right"===f?.5*(a.innerWidth()-b):.5*(a.innerWidth()-b),[d,e]}function e(){function b(b){a.select(".legend-box").attr("cursor","move"),a.select(".legend").attr("cursor","move")}function e(b){var c=a.event.x-3*g.legend.symbolLength,d=a.event.y;a.select(".legend-box").attr("transform","translate("+c+","+d+")"),a.select(".legend").attr("transform","translate("+c+","+d+")")}var f,h=c(),i=this.group(),j=i.element().selectAll("g.legend").data([!0]),k=i.element().selectAll(".legend-box").data([!0]),l=g.legend,m=l.padding,n=l.position,o=Db.indexOf(n)>-1,p=i.scale(i.dim(l.font.size)),q=Math.round(p/3),r=p+l.textPadding,s=l.symbolLength+l.symbolPadding,t=[[[0,0],[l.symbolLength,0]]],u=a.svg.line(),v=a.svg.symbol(),w=a.behavior.drag().on("drag",e).on("dragstart",b),x=0,y=0;k.enter().append("rect").classed("legend-box",!0),j.enter().append("g").classed("legend",!0),l.draggable&&(k.call(w),j.call(w));var z=j.selectAll(".legend-item").data(h),A=j.node();z.enter().append("g").classed("legend-item",!0),z.exit().remove(),z.each(function(){var b=a.select(this),c=b.datum();if(o||(y=c.index*r),c.line&&!c.bar?(f=b.selectAll("path.line").data([!0]),f.enter().append("path").classed("line",!0),f.data(t).attr("transform","translate("+x+","+(y-q)+")").attr("d",u).attr("stroke-width",c.lineWidth||c.line.lineWidth).attr("stroke",c.color||c.line.color).attr("stroke-opacity",c.colorOpacity||c.line.colorOpacity)):b.selectAll("path.line").data([]).exit().remove(),c.point||c.bar){var d=c.point||c.bar;f=b.selectAll("path.symbol").data([!0]),f.enter().append("path").classed("symbol",!0),f.attr("transform","translate("+(x+g.legend.symbolLength/2)+","+(y-q)+")").attr("stroke-width",c.lineWidth||d.lineWidth).attr("stroke",c.color||d.color).attr("fill",c.fill||d.fill).attr("stroke-opacity",c.colorOpacity||d.colorOpacity).attr("d",v)}else b.selectAll("path.symbol").data([]).exit().remove();f=b.selectAll("text").data([!0]),f.enter().append("text"),oa(f.attr("x",x+s).attr("y",y).text(c.label),g.legend.font),o&&(x+=this.getBBox().width+s)});var B=A.getBBox(),C=Math.ceil(B.height+2*m),D=Math.ceil(B.width+2*m),E=d(i,D,C);j.attr("transform","translate("+E[0]+","+E[1]+")"),k.attr("transform","translate("+E[0]+","+E[1]+")").attr("x",B.x-m).attr("y",B.y-m).attr("height",C).attr("width",D).attr("fill",g.legend.fill).attr("stroke",g.legend.color).attr("lineWidth",g.legend.lineWidth)}function f(){var b,e=c(),f=this.group(),h=f.context(),i=g.legend,j=i.font.size,k=f.scale(f.dim(j)),l=(Math.round(k/3),f.factor()),m=l*i.padding,n=l*i.textPadding,o=l*i.symbolPadding,p=l*i.symbolLength,q=Math.ceil(.333*p),r=p+o,s=k+n,t=Db.indexOf(i.position)>-1,u=a.canvas.line(),v=a.canvas.symbol().size(q*q),w=0,x=0;h.save(),f.transform(h),i.font.size=k+"px",h.font=_a(i.font),i.font.size=j,h.textBaseline="middle",t?(x=s,e.forEach(function(a){w&&(w+=o),b=h.measureText(a.label),w+=r+b.width})):e.forEach(function(a){b=h.measureText(a.label),w=Math.max(w,r+b.width),x+=s});var y=2*(m+l*i.lineWidth);x=Math.ceil(x+y),w=Math.ceil(w+y);var z=d(f,w,x);w-=2*l*i.lineWidth,x-=2*l*i.lineWidth,h.translate(z[0],z[1]),h.beginPath(),a.canvas.drawPolygon(h,[[-m,-m],[w,-m],[w,x],[-m,x]],i.radius),h.fillStyle=a.canvas.rgba(i.fill,i.fillOpacity),h.strokeStyle=a.canvas.rgba(i.color,i.colorOpacity),h.lineWidth=l*i.lineWidth,h.fill(),h.stroke();var A=0,B=s/2;e.forEach(function(b){if(b.line&&!b.bar&&(u.context(h)([[A,B],[A+p,B]]),h.strokeStyle=b.color||b.line.color,h.lineWidth=l*b.line.lineWidth,h.stroke()),b.point||b.bar){var c=b.point||b.bar;h.save(),h.translate(A+.5*l*i.symbolLength,B),v.context(h)(),a.canvas.style(h,Ma({},c,b)),h.restore()}A+=r,h.fillStyle=i.color,h.fillText(b.label,A,B),t?A+=h.measureText(b.label).width+o:(A=0,B+=s)}),h.restore()}var g;b.Legend=function(a){var c=b.paper().select(".chart-legend");return!c&&a&&(c=b.paper().classGroup("chart-legend",{margin:g.legend.margin}),c.add("svg"===c.type()?e:f)),c},b.on("tick.legend",function(){if(g||(g=b.options(),g.contextmenu.push({label:function(){return b.paper().select(".chart-legend")?"Hide legend":"Show legend"},callback:function(){var a=b.paper().select(".chart-legend");a?a.remove():b.Legend(!0).render()}})),!b.drawing())if(g.legend.show)b.Legend(!0).render();else{var a=b.Legend();a&&a.remove()}})}}),Ca.paper.plugin("line",{defaults:{interpolate:"cardinal",colorOpacity:1,fillOpacity:.4,lineWidth:2,fill:"color",active:{}},options:function(a){this.optionsShow(a,["active","tooltip"])},init:function(a){var b=a.type();a.path=function(c,d){return d||(d={}),ea(a,d),a.drawColor(Na(a.options().line,d)),a.add(Ca[b].path(a)).pointOptions(Gb).size(Hb).data(c).options(d)}}}),Ca.svg.path=function(b){function c(a,c){var d=b.paper().svgBackground(c),e=d.select("#"+a);return!e.size()&&c&&(e=d.append("g").attr("id",a).attr("transform","translate("+b.marginLeft()+","+b.marginTop()+")")),e}return xa(b,function(){var d,e,f=this,g=f.options(),h=b.element(),i=f.uid(),j="area-"+i,k=h.select("#"+i),l=g.transition,m=this.path_line(),n=this.path_data();if(k.node()){if(k.datum(n),e=c(j),g.area){e.size()||(e=c(j,!0));var o=e.select("path");o.size()||(o=e.append("path")),e=o.datum(n)}else e.remove(),e=null;!b.resizing()&&l&&l.duration&&(k=k.transition().duration(l.duration).ease(l.ease),e&&(e=e.transition().duration(l.duration).ease(l.ease)))}else k=h.append("path").attr("id",i).datum(n),g.area&&(e=c(j,!0).append("path").datum(n));return k.attr("d",m).attr("stroke",f.color).attr("stroke-opacity",f.colorOpacity).attr("stroke-width",f.lineWidth).attr("fill","none"),e&&(m=f.path_area(),f.fill||(f.fill=f.color),e.attr("d",m).attr("stroke","none"),g.gradient?Ca.gradient().colors([{color:f.fill,opacity:f.fillOpacity,offset:0},{color:g.gradient,opacity:f.fillOpacity,offset:100}]).direction("y")(e):b.setBackground(f,e)),f.active&&f.active.symbol&&b.events(b.paper().element(),i,function(){d||(d=h.append("path").attr("id","point-"+i).datum(Ca.svg.point(f,[],0)).attr("d",f.symbol));var c=a.mouse(this),e=c[0]-b.marginLeft(),g=f.bisect(e);return g?(d.attr("transform","translate("+g.sx+","+g.sy+")"),d.datum().data=g.data,d.node()):void 0}),k})},Ca.canvas.path=function(b){{var c,d,e,f,g=pa(xa(b));g.scalex,g.scaley}return g.render=function(){if(c=g.options(),d=g.path_data(),f=g.context(),f.save(),b.transform(f),c.area){var e=b.paper().canvasBackground(!0).node().getContext("2d");if(e.save(),b.transform(e),g.fill||(g.fill=g.color),g.path_area().context(e)(d),c.gradient){var h=b.yaxis().scale(),i=h.domain();Ca.gradient().y1(h(i[i.length-1])).y2(h(i[0])).direction("y").colors([{color:a.canvas.rgba(g.fill,g.fillOpacity),offset:0},{color:a.canvas.rgba(c.gradient,g.fillOpacity),offset:100}])(a.select(e.canvas))}else e.fillStyle=a.canvas.rgba(g.fill,g.fillOpacity),e.fill();e.restore()}return f.strokeStyle=g.color,f.lineWidth=b.factor()*g.lineWidth,g.path_line().context(f)(d),f.stroke(),f.restore(),g},g.inRange=function(a,c){g.options();if(!g.active)return!1;if(!g.active.symbol)return!1;e||(e=Ca.canvas.point(g,[],0));var d=g.bisect(a-b.marginLeft());return d?(e.data=d.data,e):!1},g},Ca.data.geo=function(b){function c(a){var c,e;return h=1/0,i=-(1/0),b.forEach(function(b){b={object:b},c=d&&d.get?d.get(b.object.id):null,c&&(e=+f(c),e===e&&(h=Math.min(e,h),i=Math.max(e,i),b.data=[g(c),e])),a.push(b)}),j(0)!==j(0)&&(h=Math.max(h,1),i=Math.max(i,h)),j.domain([h,i]),a}var d,f=function(a){return a.value},g=function(a){return a.label},h=1/0,i=-(1/0),j=a.scale.linear();return c.value=function(a){return arguments.length?(f=e(a),c):f},c.label=function(a){return arguments.length?(g=e(a),c):g},c.data=function(a){return arguments.length?(d=a,c):d},c.minvalue=function(){return h},c.maxvalue=function(){return i},c.scale=function(a){return arguments.length?(j=a,c):j},c},Ca.paper.plugin("map",{defaults:{scale:1,color:"#333",missingFill:"#d9d9d9",fill:"none",fillOpacity:1,colorOpacity:1,lineWidth:.5,projection:null,features:null,dataScale:"log",active:{fill:"darker"},formatX:c,tooltip:{template:function(a){return"<p><strong>"+a.x+"</strong> "+a.y+"</p>"}}},options:function(a){this.optionsShow(a,["active","tooltip"])},init:function(a){a.map=function(b,c){var d=a.type();c||(c={}),Na(a.options().map,c),a.element().classed("geo",!0);var e=a.add(ya(a,Ca[d].mapdraw)).options(c).data(b);return e}}}),Ca.svg.mapdraw=function(){var b=this,c=b.options(),d=b.group(),e=d.element().selectAll("#"+b.uid()),f=c.transition,g=b.features(),h=d.resizing();if(e.size()||(e=d.element().append("g").attr("id",b.uid()),h=!0),!g)return c.features(function(a){b.features(a).render()});var i=b.dataFeatures();c.grid&&(i=i.slice(),i.push(b.graticule()));var j=e.selectAll("path").data(i),k=b.path();j.enter().append("path"),j.exit().remove(),d.events(j),!h&&f&&f.duration&&(j=j.transition().duration(f.duration).ease(f.ease)),d.draw(j).style("vector-effect","non-scaling-stroke").attr("id",function(a){return a.object.id}).attr("d",function(a){return k(a.object)}),d.on("zoom.map",function(){e.attr("transform","translate("+a.event.translate+")scale("+a.event.scale+")")})},Ca.svg.feature=function(a,b,c){var d=a.group();return c=na(a,b,c),c.render=function(a){d.draw(a)},c},Ca.canvas.mapdraw=function(){var a=this,b=a.options(),c=a.group(),d=a.features();if(!d)return b.features(function(b){a.features(b).render()});b.grid&&(d=d.slice(),d.push(a.graticule()));var e=a.path(),f=c.context();e.context(f),d.forEach(function(a){e(a.object)})},Ca.canvas.feature=function(a,b){var c=a.group();return b.render=function(b){c.draw(b).attr("d",a.symbol?a.symbol:a.path())},b},Ca.contextMenu=function(){function b(a,b){h(),a.on("keyup.gmenu",c).on("click.gmenu",d).on("contextmenu.gmenu",e(b))}function c(){!l&&k&&27===a.event.keyCode&&g()}function d(){var b=a.event;(!l&&k&&2!==b.button||b.target!==i)&&g()}function e(b){return b?function(){if(!l){var c=a.event;c.preventDefault(),c.stopPropagation(),g(),i=this,f(c,b)}}:void 0}function f(a,b){b&&b(j),j.classed("open",!0);var c=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0),d=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||0),e=j.node().scrollWidth,f=j.node().scrollHeight,g=document.clientWidth+c,h=document.clientHeight+d,i=e+a.pageX,l=f+a.pageY,m=Math.max(a.pageX-c,0),n=Math.max(a.pageY-d,0);i>g&&(m-=i-g),l>h&&(n-=l-h),j.style({top:n+"px",left:m+"px",position:"fixed"}),k=!0}function g(){j.classed("open",!1),k&&m.close(),k=!1}function h(){j||(j=a.select(document.createElement("div")).attr("class","giotto-menu"),g(),document.body.appendChild(j.node()),a.select(document).on("keyup.gmenu",c).on("click.gmenu",d).on("contextmenu.gmenu",d))}var i=null,j=null,k=!1,l=!1,m=a.dispatch("open","close");return b.disabled=function(a){return arguments.length?(l=a?!0:!1,b):l},a.rebind(b,m,"on"),b},Ca.contextmenu=Ca.contextMenu(),Ca.viz.plugin("menu",{init:function(a){a.contextmenu=function(b){var c=a.options();b.append("ul").attr("class","dropdown-menu").attr("role","menu").selectAll("li").data(c.contextmenu).enter().append("li").append("a").attr("role","menuitem").text(function(a){return Ua(a.label)?a.label():a.label}).attr("href","#").on("click",function(b){b.callback&&b.callback(a)})},a.on("tick.menu",function(){var b=a.options();b.contextmenu?Ca.contextmenu(a.element(),function(b){return a.contextmenu(b)}):Ca.contextmenu(a.element())})}}),Ca.paper.plugin("pie",{defaults:{lineWidth:1,padAngle:0,cornerRadius:0,fillOpacity:.7,colorOpacity:1,innerRadius:0,startAngle:0,formatX:c,formatPercent:",.2%",active:{fill:"darker",color:"brighter",fillOpacity:1},tooltip:{template:function(a){return"<p><strong>"+a.x+"</strong> "+a.y+"</p>"}},labels:{show:!0,position:"ouside",outerRadius:1.05,color:"#333",colorOpacity:.5,lineWidth:1}},options:function(a){this.optionsShow(a,["active","tooltip","labels"])},init:function(b){var c=b.type(),d=a[c].arc().innerRadius(function(a){return a.innerRadius}).outerRadius(function(a){return a.outerRadius});b.pie=function(e,f){f||(f={}),ea(b,f),Na(b.options().pie,f);var g=b.add(function(){var e,f,g=b.innerWidth(),h=b.innerHeight(),i=this.options(),j=.5*Math.min(g,h),k=i.innerRadius*j,l=b.scale(b.dim(i.cornerRadius)),m=this.y(),n=this.data(),o=a.layout.pie().value(function(a){return m(a.data)}).padAngle(fb*i.padAngle).startAngle(fb*i.startAngle)(n);this.arc=d.cornerRadius(l);for(var p=0;p<o.length;++p)e=o[p],f=e.data,f.set("innerRadius",k),f.set("outerRadius",j),delete e.data,n[p]=Ma(f,e);return Ca[c].pie(this,g,h)});return g.pointOptions(Ra(["innerRadius","outerRadius"],ub)).dataConstructor(Eb).options(f).data(e)}}});var Eb=function(b){var c,d=this,e=d.x(),f=Ca[d.group().type()].pieslice,g=a.map(this.data()||[],function(a){return e(a.data)}),h=[];return b.forEach(function(a){c=g.get(e(a)),c?c.data=a:c=f(d,a),h.push(c)}),h};Ca.svg.pie=function(a,b,c){var d=a.group(),e=d.element(),f=a.options(),g=f.transition,h=e.select("#"+a.uid()),i=d.resizing();h.size()||(i=!0,h=e.append("g").attr("id",a.uid()).classed("pie",!0),h.append("g").classed("slices",!0));var j=h.attr("transform","translate("+b/2+","+c/2+")").select(".slices").selectAll(".slice").data(a.data());return j.enter().append("path").attr("class","slice"),j.exit().remove(),d.events(j),f.labels.show&&Ca.svg.pielabels(a,h,f),!i&&g&&g.duration&&(j=j.transition().duration(g.duration).ease(g.ease)),d.draw(j.attr("d",a.arc))},Ca.svg.pieslice=function(a,b){var c=a.group(),d=Aa(a,b,{});return d.render=function(b){c.draw(b).attr("d",a.arc)},d},Ca.svg.pielabels=function(b,c,d){function e(a){return(a.endAngle-a.startAngle)/cb}function f(b){function c(a){return 20>a?100/(a*a):0}var d=b.length,e=1e4,f=100;if(!(3>d)){var h,i,j,k=g.innerHeight()/2+g.marginTop(),l=g.innerHeight()/2+g.marginBottom(),m=0;for(b.sort(function(b,c){return a.ascending(b.labelY,c.labelY)}),k=Math.min(b[0].labelY,-k+10),l=Math.max(b[d-1].labelY,l-10);e>.5&&f>m;){j=b[0].labelY,m++,e=0,b[0].dy=0;for(var n=1;n<b.length;++n)i=j,
j=b[n].labelY,h=c(j-i),b[n-1].dy-=h,b[n].dy=h;for(n=1;n<b.length-1;++n)h=b[n].dy<0?Math.max(b[n].dy,.49*(b[n-1].labelY-b[n].labelY)):Math.min(b[n].dy,.49*(b[n+1].labelY-b[n].labelY)),e=Math.max(e,gb(h)),b[n].labelY+=h;b[0].labelY=Math.max(b[0].labelY+b[0].dy,k),b[d-1].labelY=Math.min(b[d-1].labelY+b[d-1].dy,l)}}}var g=b.group(),h=Ma({},b.group().options().font,d.labels),i=c.selectAll(".labels"),j=d.transition,k=g.resizing(),l=a.format(d.formatPercent);if(i.size()||(k=!0,i=c.append("g").classed("labels",!0)),"bar"===h.position);else{var m,n=b.x(),o=i.selectAll("text").data(b.data());if(o.enter().append("text"),o.exit().remove(),oa(o,h),!k&&j&&j.duration&&(o=o.transition().duration(j.duration).ease(j.ease)),"outside"===h.position){var p=a.svg.arc(),q=c.selectAll(".lines").data([!0]);q.enter().append("g").classed("lines",!0),q=q.selectAll("polyline").data(b.data()),q.enter().append("polyline"),q.exit().remove(),!k&&j&&j.duration&&(q=q.transition().duration(j.duration).ease(j.ease));var r=[],s=[];b.data().forEach(function(a){a.labelAngle=za(a),a.labelRadius=a.outerRadius*h.outerRadius,a.labelTurn=p.innerRadius(a.labelRadius).outerRadius(a.labelRadius).centroid(a),a.labelY=a.labelTurn[1],a.labelAngle<bb?r.push(a):s.push(a)}),f(r),f(s),q.attr("points",function(a){return m=[1.05*a.labelRadius*(a.labelAngle<bb?1:-1),a.labelY],[b.arc.centroid(a),a.labelTurn,m]}).attr("fill","none").attr("stroke",h.color).attr("stroke-opacity",h.colorOpacity).attr("stroke-width",h.lineWidth),o.text(function(a){return n(a.data)+" "+l(e(a))}).attr("transform",function(a){return m=[1.1*a.labelRadius*(a.labelAngle<bb?1:-1),a.labelY],"translate("+m+")"}).style("text-anchor",function(a){return za(a)<bb?"start":"end"})}}},Ca.canvas.pie=function(a){a.each(function(){this.reset().render()})},Ca.canvas.pieslice=function(b,c){function d(a){var c=e.context();c.save(),f.transform(c),c.translate(.5*f.innerWidth(),.5*f.innerHeight()),b.arc.context(c)(e);var d=a(c);return c.restore(),d}{var e=Aa(b,c,{}),f=b.group();b.factor()}return e.render=function(){return d(function(b){return a.canvas.style(b,e),e})},e.inRange=function(a,b){return d(function(c){return c.isPointInPath(a,b)})},e},Ca.paper.plugin("point",{defaults:{symbol:"circle",size:"8px",fill:!0,fillOpacity:1,colorOpacity:1,lineWidth:2,active:{fill:"darker",color:"brighter",size:"150%"},transition:Ma({},Ca.defaults.transition)},options:function(a){this.optionsShow(a,["active","tooltip"])},init:function(a){var b=a.type();a.points=function(c,d){return d||(d={}),ea(a,d),a.drawColor(Na(a.options().point,d)),a.add(Ca[b].points).pointOptions(Gb).size(Hb).options(d).dataConstructor(Ib).data(c)}}});var Fb={circle:.7,cross:.7,diamond:.7,"triangle-up":.6,"triangle-down":.6},Gb=Ra(["size","symbol"],ub),Hb=function(a){var b=+a.size;if(isNaN(b)){var c=a.group();b=c.scale(c.xfromPX(a.size.substring(0,a.size.length-2)))}return b*b*(Fb[a.symbol]||1)},Ib=function(a){for(var b=this.group(),c=b.scale(b.dim(this.options().size)),d=Ca[b.type()].point,e=[],f=0;f<a.length;f++)e.push(d(this,a[f],c));return e};Ca.svg.point=function(a,b,c){var d=na(a,b),e=a.group();return d.set("size",void 0===b.size?c:b.size),d.render=function(b){e.draw(b).attr("d",a.symbol)},d},Ca.svg.points=function(){{var b=this.group(),c=b.element().select("#"+this.uid()),d=this.scalex(),e=this.scaley();this.data()}this.symbol=a.svg.symbol().type(function(a){return a.symbol}).size(this.size()),c.node()||(c=b.element().append("g").attr("id",this.uid()),this.remove=function(){c.remove()});var f=c.selectAll("*").data(this.data());return f.enter().append("path"),f.exit().remove(),b.events(b.draw(f.attr("transform",function(a){return"translate("+d(a.data)+","+e(a.data)+")"}).attr("d",this.symbol))),c},Ca.canvas.points=function(){this.each(function(){this.reset().render()})},Ca.canvas.point=function(b,c,d){function e(){return b.Symbol||(b.Symbol=a.canvas.symbol().type(function(a){return a.symbol}).size(b.size())),b.Symbol}function f(a){var b=g.context();b.save(),j.transform(b),b.translate(h(g.data),i(g.data)),e().context(b)(g);var c=a(b);return b.restore(),c}var g=pa(na(b,c)),h=b.scalex(),i=b.scaley(),j=(b.factor(),b.group());return g.set("size",void 0===c.size?d:c.size),g.render=function(){return f(function(b){return a.canvas.style(b,g),g})},g.inRange=function(a,b){return f(function(c){return c.isPointInPath(a,b)})},g.bbox=function(){var a=h(g.data)+j.marginLeft(),b=i(g.data)+j.marginTop(),c=Math.sqrt(e().size()(g));return qa(g,[a-c,b-c],[a+c,b-c],[a+c,b+c],[a-c,b+c])},g},Ca.paper.plugin("transitions",{defaults:{duration:0,ease:"easeInOutCubic"}}),Ca.constants.groupEvents.push("zoom"),Ca.chart.plugin("zoom",{defaults:{x:!1,y:!1,scaleExtent:[1,10]},init:function(b){function c(a,b,c){c.x&&a.x(b.xaxis().scale()),c.y&&a.y(b.yaxis().scale()),b.render()}var d=!1;b.zooming=function(){return d},b.enableZoom=function(){var e=b.options().zoom,f=a.behavior.zoom().on("zoom",function(){d=!0,b.each(function(a){c(f,a.group(),e)}),d=!1});e.scaleExtent&&f.scaleExtent(e.scaleExtent),f(b.element())},b.on("tick.zoom",function(){var a=b.options().zoom;(a.x||a.y)&&b.enableZoom()})}});var Jb=Jb||{};if(Jb["src/text/giotto.min.css"]='@charset "UTF-8";.sunburst text{z-index:9999}.sunburst path{fill-rule:evenodd;stroke:#fff}.axis,.d3-slider-axis line{fill:none;shape-rendering:crispEdges}.line{fill:none}.d3-tip:after{line-height:1;position:absolute;display:inline;width:100%;font-size:16px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.d3-tip.n:after{top:100%;margin:-2px 0 0;left:0;content:"\\25BC";text-align:center}.d3-tip.e:after{top:50%;margin:-4px 0 0;left:-8px;content:"\\25C0"}.d3-tip.s:after{top:-8px;margin:0 0 2px;left:0;content:"\\25B2";text-align:center}.d3-tip.w:after{top:50%;margin:-4px 0 0 -1px;left:100%;content:"\\25B6"}.d3-slider{font-family:Verdana,Arial,sans-serif;margin:20px;position:relative;z-index:2;font-size:1.1em;border:1px solid}.d3-slider-horizontal{height:.8em}.d3-slider-horizontal.d3-slider-axis{margin-bottom:30px}.d3-slider-range{right:0;position:absolute;height:.8em;left:0}.d3-slider-range-vertical{top:0;right:0;position:absolute;left:0}.d3-slider-range-vertical.d3-slider-axis{margin-right:30px}.d3-slider-vertical{height:100px;width:.8em}.d3-slider-handle{z-index:3;position:absolute;height:1.2em;width:1.2em;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;border:1px solid}.d3-slider-horizontal .d3-slider-handle{top:-.25em;margin-left:-.6em}.d3-slider-axis{z-index:1;position:relative}.d3-slider-axis-bottom{top:.8em}.d3-slider-axis-right{left:.8em}.d3-slider-axis path{fill:none;stroke-width:0}.d3-slider-axis text{font-size:11px}.d3-slider-vertical .d3-slider-handle{margin-bottom:-.6em;left:-.25em;margin-left:0}',b.giottostyle!==!1){var Kb=document.createElement("style");Kb.innerHTML=Jb["src/text/giotto.min.css"],document.getElementsByTagName("head")[0].appendChild(Kb)}return Ca.angular=function(){var a,b={};return b.mixin=function(a){var b;if(a.scope=function(c){if(!arguments.length)return b;var d=a.options();return b=c,Ua(d.angular)&&d.angular(a,d),a},a.tick){var c=a.tick;a.tick=function(){b&&b.stats&&b.stats.begin(),c(),b&&b.stats&&b.stats.end()}}return a},b.module=function(c,d,e){return arguments.length?(a||(d=d||"giotto",e=e||[],a=c.module(d,e),a.config(["$compileProvider",function(b){a.directive=function(a,c){return b.directive(a,c),this}}]).directive("giottoCollection",function(){return{restrict:"AE",controller:["$scope",function(a){a.giottoCollection=b.mixin(Ca.collection())}],link:function(a,b,c){var d=Pa(c),e=d.require;e?(Ca._.isArray(e)||(e=[e]),require(e,function(b){Ma(d,b),a.giottoCollection.options(d).scope(a).start()})):a.giottoCollection.options(d).scope(a).start()}}}).directive("jstats",function(){return{link:function(a,b,d){var e=d.mode?+d.mode:1;require(["stats"],function(){var d=new Stats;d.setMode(e),a.stats=d,b.append(c.element(d.domElement))})}}})),b):a},b.directive=function(c,d,e){function f(a,f,g,h){for(var i=a.giottoCollection,j=0;j<h.length;++j)g[e[j]]=h[j];var k=b.mixin(c(f[0],g)).scope(a);if(f.data(d,k),i){var l=g.key||i.size()+1;i.set(l,k)}else a.$emit("giotto-viz",k),k.start()}return a?(e=e?e.slice():[],d=a.name.toLowerCase()+d.substring(0,1).toUpperCase()+d.substring(1),e.push(function(){var a=arguments;return{restrict:"AE",link:function(b,c,e){var g=c.data(d);if(!g){var h=Pa(e),i=h.require;i?(Ca._.isArray(i)||(i=[i]),require(i,function(d){Ma(h,d),f(b,c,h,a)})):f(b,c,h,a)}}}}),a.directive(d,e)):void Ca.log.warn("No angular module, cannot add directive")},b.addAll=function(a){return Ca.log.info("Adding giotto visualization directives"),angular.forEach(Ca.viz,function(b){var c=b.vizName?b.vizName():null;c&&Ca.angular.directive(b,c,a)}),b},b}(),Ca.defaults.crossfilter={tolerance:1.1},Ca.crossfilter=function(a){function b(){if(!Ca.crossfilter.lib)throw Error("Could not find crossfilter library");c.data=Ca.crossfilter.lib(d),Ca._.isArray(a.dimensions)&&a.dimensions.forEach(function(a){c.dimension(a)}),e&&e(c)}var c=Ma({},Ca.defaults.crossfilter,a),d=a.data,e=a.callback;if(c.dims={},c.dimension=function(a,b){b||(b=function(b){return b[a]}),c.dims[a]=c.data.dimension(b)},c.reduceDensity=function(a,b,d,e){var f,g=c.dims[a];if(!g)throw Error('Cross filter dimension "'+a+'"" not available. Add it with the addDimension method');void 0===d&&(d=null),void 0===e&&(e=null),f=null===d&&null===e?g.filter():g.filter(function(a){return null!==d&&d>a||null!==e&&a>e?void 0:!0});var h=f.bottom(1/0);if(h.length>c.tolerance*b){var i,j,k,l=Ca.math.kmeans(),m=[],n=[],o=[],p=h.length/b;for(j=0;j<h.length;j++)n.push([h[j][a]]);for(j=0;b>j;j++)o.push(n[Math.round(j*p)]);l.centroids(o).maxIters(10),n=l.cluster(n).sort(function(a,b){return a.centroid[0]-b.centroid[0]}),n.forEach(function(a){for(i=a.indices[0],k=a.points[0],j=1;j<a.points.length;++j)a.points[j]>k&&(i=a.indices[j],k=a.points[j]);m.push(h[i])}),h=m}return h},void 0===Ca.crossfilter.lib){if("undefined"==typeof crossfilter)return require(["crossfilter"],function(a){Ca.crossfilter.lib=a||null,b()}),c;Ca.crossfilter.lib=crossfilter}return b(),c},Ca.geo.leaflet=function(b,c){function d(a,b){var c=e.latLngToLayerPoint(new L.LatLng(b,a));this.stream.point(c.x,c.y)}if("undefined"==typeof L)Ca._.loadCss(Ca.constants.leaflet),Ca.require(["leaflet"],function(){viz.start()});else{var e=new L.map(b,{center:c.center,zoom:c.zoom});c.zoomControl?c.wheelZoom||e.scrollWheelZoom.disable():(e.dragging.disable(),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.tap&&e.tap.disable()),e.on("viewreset",function(){for(var a=0;a<callbacks.length;++a)callbacks[a]()}),viz.resume()}a.geo.transform({point:d})},a});